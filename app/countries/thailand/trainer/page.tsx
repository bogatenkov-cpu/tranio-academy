'use client';
import React, { useEffect, useState, useCallback } from 'react';
import { useRouter } from 'next/navigation';
import { Brain, RotateCcw, CheckCircle, XCircle, Trophy, ChevronRight, Zap, TrendingUp, Loader2 } from 'lucide-react';
import Link from 'next/link';
import { AppHeader, AppFooter } from '@/components/AppShell';
import { useAuth } from '@/contexts/AuthContext';
import { useProgress } from '@/lib/hooks/useProgress';

interface Question {
  id: string;
  question: string;
  options: string[];
  correctAnswer: number;
  explanation: string;
  category: string;
  difficulty: 'easy' | 'medium' | 'hard';
}

export default function TrainerPage() {
  const router = useRouter();
  const { user, loading: authLoading } = useAuth();
  const { progress: userProgress, loading: progressLoading, addPoints, updateStreak, addStudiedCard, addActivity } = useProgress('thailand');
  const [userName, setUserName] = useState('');
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null);
  const [showExplanation, setShowExplanation] = useState(false);
  const [isCorrectAnswer, setIsCorrectAnswer] = useState<boolean>(false);
  const [selectedCategory] = useState<string>('all');
  const [studyMode] = useState<'all' | 'new' | 'review'>('all');
  const [score, setScore] = useState({ correct: 0, total: 0 });
  const [sessionQuestions, setSessionQuestions] = useState<Question[]>([]);
  const [studiedQuestions, setStudiedQuestions] = useState<Set<string>>(new Set());
  const [streak, setStreak] = useState(0);
  const [isAnimating, setIsAnimating] = useState(false);

  // База вопросов по Таиланду с вариантами ответов
  const allQuestions: Question[] = [
    // Урок 1: Районы и локации
    {
      id: 'loc1',
      question: 'Клиент: "Мы семья с двумя детьми, планируем переезд на 1–2 года. Нужна спокойная, семейная локация с широкой береговой линией, зеленью, доступом к международной школе и аккуратной инфраструктурой. При этом хотим, чтобы при необходимости можно было сдавать жильё посуточно без жесткого турпотока у дверей. Что посоветуете?"',
      options: [
        'Район Чавенг/центральная туристическая зона Самуи',
        'Район Маенам (Север Самуи)',
        'Южные удалённые пляжи Самуи',
        'Район Талинг Нгам (побережье Самуи)'
      ],
      correctAnswer: 1,
      explanation: 'Маенам сочетает спокойный пляжный формат с развитой бытовой инфраструктурой и образовательными опциями, которые важны для семей. Это не самая туристическая часть острова, поэтому жилые объекты ориентированы на долгосрочное проживание и семейный комфорт.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc2',
      question: 'Клиент: "Хочу купить апартамент, рассчитываю на быстрый доход от краткосрочной аренды — молодая аудитория, beach-club lifestyle, близость модных ресторанов и шопинга. При этом готов мириться с вечерними событиями и дороже стоимостью обслуживания." Какой район Пхукета лучше презентовать?',
      options: [
        'Панва',
        'Най Харн',
        'Банг Тао / Лагуна',
        'Сурин'
      ],
      correctAnswer: 2,
      explanation: 'Банг Тао сочетает длинный пляж, несколько известных beach-club\'ов и крупные комплексы (Laguna, Porto de Phuket, Boat Avenue), что создаёт поток гостей и высокий потенциал для краткосрочной сдачи.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc3',
      question: 'Клиент: "Мне нужна приватная вилла класса люкс на мысе, где соседи — в основном дорогие отели и закрытые резиденции. Для отдыха — главное уединение и сервиса 5-звёзд. Я готов заплатить премию. Куда вести клиента?"',
      options: [
        'Лайан/север Банг Тао',
        'Чавенг',
        'Мыс Панва',
        'Маенам (Самуи)'
      ],
      correctAnswer: 2,
      explanation: 'Мыс Панва исторически позиционируется как уединённая люксовая локация: премиальные отели и виллы, закрытые территории, акцент на приватности и высочайшем уровне сервиса.',
      category: 'locations',
      difficulty: 'hard'
    },
    {
      id: 'loc4',
      question: 'Клиент-инвестор: "Ищу участок/проект для wellness-концепта: спа-ретриты, йога-комплекс, программы детокса. Хочу локацию с приватными видами на закат, уединением и возможностью позиционировать проект как премиум-wellness." Что предложите?',
      options: [
        'Чавенг',
        'Талинг Нгам (Самуи)',
        'Банг Тао',
        'Липа Ной'
      ],
      correctAnswer: 1,
      explanation: 'Талинг Нгам выделяется как премиальная зона с панорамными точками, низкой плотностью застройки и подходящей аудиторией для high-end wellness-форматов.',
      category: 'locations',
      difficulty: 'hard'
    },
    {
      id: 'loc5',
      question: 'Клиент: "Нужен лучший южный пляж Пхукета для семейного отдыха: чистая вода, безопасный заход в море, спокойная атмосфера, минимальная ночная шумиха." Какой район презентовать?',
      options: [
        'Пляж Сурин',
        'Патонг',
        'Най Харн',
        'Лагуна/Банг Тао'
      ],
      correctAnswer: 2,
      explanation: 'Най Харн известен как один из самых комфортных южных пляжей острова: спокойная атмосфера, удобный заход в воду, локальная инфраструктура для семей.',
      category: 'locations',
      difficulty: 'easy'
    },
    {
      id: 'loc6',
      question: 'Клиент: "Я хочу локацию для покупки кондоминиума, где можно сочетать долгосрочную аренду и сезонное сдавание. Главные требования — развитая инфраструктура, близость к пляжу, но умеренный поток туристов."',
      options: [
        'Чавенг',
        'Маенам (Самуи)',
        'Липа Ной',
        'Панва'
      ],
      correctAnswer: 1,
      explanation: 'Маенам сочетает доступность, умеренный поток туристов и инфраструктуру для долгосрочной и краткосрочной аренды.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc7',
      question: 'Клиент: "Для постоянного проживания мне важны международные школы и хорошие клиники, плюс разумная удалённость от аэропорта. Нужна локация на Самуи с удобной инфраструктурой для семьи."',
      options: [
        'На Муанг',
        'Бо Пхут / северо-восток Самуи',
        'Талинг Нгам',
        'Липа Ной'
      ],
      correctAnswer: 1,
      explanation: 'Бо Пхут описывается как северо-восточный центр с высокой плотностью инфраструктуры: международные школы, клиники, пирсы и большое число туристических сервисов.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc8',
      question: 'Клиент: "Хочу виллу под спокойный отдых вдали от цивилизации — дикое побережье, минимальный турпоток, максимальное уединение. На что ориентировать клиента?"',
      options: [
        'Северо-восток Самуи — Maenam/Bo Phut',
        'Юг Самуи',
        'Банг Тао',
        'Чавенг'
      ],
      correctAnswer: 1,
      explanation: 'Южные районы Самуи исторически менее застроены и предпочтительны для уединения: редкая инфраструктура, натуральные пляжные участки и большое расстояние до основных туристических зон.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc9',
      question: 'Клиент: "Интересует пляж с предсказуемыми условиями купания и умеренным туристическим потоком на Пхукете."',
      options: [
        'Восточное побережье Панвы',
        'Западные пляжи, как Банг Тао и Най Харн',
        'Панва',
        'Чавенг'
      ],
      correctAnswer: 1,
      explanation: 'Западные пляжи острова предоставляют стабильные условия для купания, умеренный турпоток и хорошую инфраструктуру, что делает их предпочтительными для семей и длительного проживания.',
      category: 'locations',
      difficulty: 'easy'
    },
    {
      id: 'loc10',
      question: 'Клиент: "Я хочу проект рядом с Laguna Phuket, но у меня ограниченный бюджет на вход. Можно ли найти варианты вокруг Лагуны, где стоимость метра заметно ниже, но инфраструктура остаётся близкой?"',
      options: [
        'Нет, у Лагуны единственная ценовая планка — всё дорого',
        'Да, северная оконечность пляжа (Layan) и периферийные посёлки предлагают проекты с более низким порогом входа, сохраняя доступ к инфраструктуре Лагуны',
        'Лучше смотреть только в городах Пхукета, а не рядом с Лагуной',
        'Вариантов с более низким порогом у моря нет в принципе на всём острове'
      ],
      correctAnswer: 1,
      explanation: 'В районе существуют периферийные участки и соседние микро-локации (например, Layan или северные участки Банг Тао), где девелоперы предлагают проекты с более доступными ценами, сохраняя близость к инфраструктуре Лагуны.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc11',
      question: 'При объяснении клиенту разницы между Банг Тао и Сурином, какая характеристика будет справедливой?',
      options: [
        'Банг Тао — преимущественно тихий элитный участок без ресторанов; Сурин — крупные торговые центры и пляжные клубы',
        'Банг Тао — интегрированная курортная зона с Lagoon, гольфом и динамичной инфраструктурой; Сурин — узконаправленная зона элитных вилл и видов на море, менее массовая',
        'Оба района идентичны по типу туристического спроса и инфраструктуры',
        'Сурин имеет массовые пляжные клубы и ночные рынки в стиле Boat Avenue'
      ],
      correctAnswer: 1,
      explanation: 'Банг Тао — это смешанная и развитая зона с крупными курортными кластерами, гольф-полями и торгово-ресторанными ядрами, тогда как Сурин традиционно ассоциируется с элитными виллами и панорамными видами.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc12',
      question: 'Чем отличается Най Харн от Панва с точки зрения целевой аудитории покупателя?',
      options: [
        'Най Харн привлекает преимущественно яхтенных и морских энтузиастов; Панва — молодёжные тусовщики',
        'Най Харн — семейный пляж с локальной атмосферой и пляжным досугом; Панва — уединённая, люксовая мысовая зона, привлекательная для клиентов, ищущих приватность и премиум-отдых',
        'Оба района одинаково подходят под краткосрочную аренду молодежной аудитории',
        'Панва — массовый центр пляжного шопинга и активного отдыха'
      ],
      correctAnswer: 1,
      explanation: 'Най Харн — классический семейный и спокойный пляж; Панва позиционируется как мыс с приватными люксовыми отелями и виллами, где важна приватность и высокий сервис.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc13',
      question: 'Сравните Маенам и Бо Пхут с точки зрения характера инфраструктуры и ориентированности на разные типы покупателей:',
      options: [
        'Маенам — спокойный и семейный район с развитой бытовой инфраструктурой и рынками; Бо Пхут — более туристический центр с большим количеством сервисов, пирсов и ресторанов для краткосрочного проживания',
        'Маенам — узко туристический и развлекательный район, ориентированный на молодежь и краткосрочную аренду; Бо Пхут — тихий и закрытый район с приватными виллами',
        'Маенам — район для спокойного семейного проживания и долгосрочной аренды; Бо Пхут — центр с высокой плотностью инфраструктуры и возможностью для инвестиций в краткосрочную аренду',
        'Оба района идентичны по характеру инфраструктуры и типу целевой аудитории, разницы практически нет'
      ],
      correctAnswer: 2,
      explanation: 'Маенам больше подходит для семей, долгосрочного проживания и стабильной аренды, а Бо Пхут — это инфраструктурно насыщенный туристический кластер с пирсами, магазинами, ресторанами и сервисами.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc14',
      question: 'Как объяснить клиенту разницу между Банг Тао как районом и интегрированным комплексом Laguna Phuket?',
      options: [
        'Банг Тао — это единая премиальная зона, весь район имеет одинаковый уровень сервисов и инфраструктуры; Laguna — отдельные виллы и кондоминиумы без центральной концепции',
        'Laguna — это формально интегрированный курортный комплекс с общей инфраструктурой, гольф-полями и гостиницами, а Банг Тао — более широкий район, включающий как премиальные, так и периферийные объекты с разной плотностью и ценой',
        'Банг Тао полностью лишён туристической инфраструктуры и подходит только для долгосрочной аренды; Laguna — зона только для туристов, постоянных жителей там нет',
        'Банг Тао и Laguna идентичны, разницы нет, все объекты имеют одинаковый статус и доступ к сервисам'
      ],
      correctAnswer: 1,
      explanation: 'Laguna формирует отдельный интегрированный курортный кластер с инфраструктурой для туристов и резидентов; Банг Тао как район гораздо шире и включает как премиальные участки рядом с Laguna, так и более доступные объекты.',
      category: 'locations',
      difficulty: 'hard'
    },
    {
      id: 'loc15',
      question: 'Сравнивая доходность краткосрочной аренды Сурина и Банг Тао, какой аргумент корректен?',
      options: [
        'Сурин обеспечивает высокий поток туристов с массовой заполняемостью, что гарантирует одинаковую доходность вне зависимости от сезона',
        'Банг Тао — разнообразная локация с возможностью сдачи в аренду как элитных вилл, так и апартаментов среднего сегмента; Сурин — нишевая зона с высокой ставкой за ночь, но меньшим потоком арендаторов, что влияет на среднегодовую доходность',
        'Доходность обоих районов полностью идентична, разницы в стратегии аренды нет',
        'Банг Тао — исключительно низкая доходность из-за удалённости пляжей, Сурин — гарантированный доход вне сезона'
      ],
      correctAnswer: 1,
      explanation: 'Банг Тао позволяет работать с разными сегментами арендаторов, что снижает сезонные риски. Сурин более узконаправлен на премиум-рынок, где доходы высоки за ночь, но поток клиентов ограничен.',
      category: 'locations',
      difficulty: 'hard'
    },
    {
      id: 'loc16',
      question: 'Какой район Самуи целесообразно предлагать клиенту-инвестору, ориентированному на wellness-retreat и premium-logo (виды на закат, уединение)?',
      options: [
        'Маенам',
        'Липа Ной',
        'Талинг Нгам',
        'На Муанг'
      ],
      correctAnswer: 2,
      explanation: 'Талинг Нгам даёт преимущества для wellness-продукта: вид на закат, приватный доступ и уединённые панорамные точки, что позволяет позиционировать ретрит как премиум-опцию.',
      category: 'locations',
      difficulty: 'hard'
    },
    {
      id: 'loc17',
      question: 'Клиент спрашивает: "Где на Пхукете можно предложить проект для экспат-семьи, с хорошей пешеходной инфраструктурой, ресторанами, магазинами и опцией гольфа поблизости?"',
      options: [
        'Панва',
        'Чавенг',
        'Банг Тао / Laguna',
        'Сурин'
      ],
      correctAnswer: 2,
      explanation: 'Банг Тао сочетает пешую доступность к ресторанам и магазинам (Boat Avenue, Porto de Phuket) с гольф-полем и развитой инфраструктурой для экспат-семей.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc18',
      question: 'Клиент хочет "место, где яхт-сообщество реально использует прибрежные бухты и где можно ожидать спроса со стороны яхтсменов". Какой район выбрать?',
      options: [
        'Лагуна',
        'Панва',
        'Чавенг',
        'Маенам'
      ],
      correctAnswer: 1,
      explanation: 'Панва отмечается как бухта, используемая яхтсменами, и рядом расположены глубоководный порт и причальные сооружения, что делает этот район релевантным для клиентов-владельцев лодок.',
      category: 'locations',
      difficulty: 'hard'
    },
    {
      id: 'loc19',
      question: 'Как объяснить клиенту разницу в доступности купания на восточном побережье Панвы и западных пляжах Банг Тао/Най Харн?',
      options: [
        'Везде вода одинаково пригодна для купания независимо от побережья',
        'На восточном побережье (Панва) купаемость пляжей сильнее зависит от приливов/отливов, тогда как западные пляжи, как Банг Тао и Най Харн, в целом дают более предсказуемый заход в воду',
        'Западные пляжи всегда хуже для купания',
        'Панва — лучший вариант для массового пляжного отдыха и вечерних тусовок'
      ],
      correctAnswer: 1,
      explanation: 'Восточное побережье острова географически отличается режимом приливов/отливов и рельефом береговой линии, что отражается на пригодности для купания в разное время суток. Западные пляжи чаще имеют более стабильные условия для купания.',
      category: 'locations',
      difficulty: 'medium'
    },
    {
      id: 'loc20',
      question: 'Клиент интересуется инвестициями в недвижимость на Пхукете и хочет понять, какие факторы влияют на ликвидность объектов и скорость их последующей продажи. Какие из перечисленных факторов являются ключевыми?',
      options: [
        'Расположение рядом с туристической инфраструктурой и пляжами, что повышает интерес арендаторов и покупателей',
        'Размер и планировка объекта, которые соответствуют актуальным трендам на рынке и ожиданиям целевой аудитории',
        'Наличие индивидуального дизайна и редких архитектурных решений, которые делают объект уникальным, но могут ограничивать количество потенциальных покупателей',
        'Близость к основным транспортным узлам, аэропорту, торговым центрам и супермаркетам, что увеличивает удобство проживания и привлекательность для экспатов и туристов'
      ],
      correctAnswer: 0,
      explanation: 'Ликвидность объектов напрямую зависит от их привлекательности для конечного покупателя: удобное расположение рядом с пляжем и инфраструктурой, актуальная планировка и размеры, а также близость к транспортной и социальной инфраструктуре.',
      category: 'locations',
      difficulty: 'hard'
    },

    // Урок 2: Процедура покупки
    {
      id: 'buy1',
      question: 'Может ли иностранец купить недвижимость в Таиланде?',
      options: [
        'Нет, только тайцы',
        'Да, но только кондоминиум (квартиру) на 100% или дом через компанию',
        'Только через посредника',
        'Только коммерческую недвижимость'
      ],
      correctAnswer: 1,
      explanation: 'Иностранец может купить кондоминиум (квартиру) на 100% при условии, что в здании не более 49% иностранцев. Дом можно купить через тайскую компанию.',
      category: 'buying',
      difficulty: 'easy'
    },
    {
      id: 'buy2',
      question: 'Клиент — иностранный резидент, хочет купить участок земли и построить виллу на своё имя. Какой корректный юридический ответ брокера?',
      options: [
        'Иностранец может зарегистрировать землю на своё имя без ограничений',
        'Иностранец может владеть землёй, если зарегистрирует тайскую компанию, 100% в его собственности',
        'Иностранец не может владеть землёй напрямую; нужно использовать либо тайскую компанию с минимум 51% тайских акционеров, либо долгосрочную аренду земли',
        'Можно купить землю и оформлять её как "коммерческую собственность" на иностранца'
      ],
      correctAnswer: 2,
      explanation: 'По тайскому праву иностранцы не имеют прямого права на владение землёй; возможны структуры через компанию (где ≥51% принадлежит тайцам) либо долгосрочная аренда земли (обычно 30 лет с опцией пролонгации).',
      category: 'buying',
      difficulty: 'hard'
    },
    {
      id: 'buy3',
      question: 'Клиент спрашивает: "Можно ли купить свободно всю квартиру в кондоминиуме как иностранец?" Вы отвечаете:',
      options: [
        'Да — никаких ограничений, можно 100% свободно',
        'Да, но максимальная доля иностранцев в одном здании ограничена — только 49% жилой площади может принадлежать иностранцам',
        'Нельзя — иностранцы не имеют право владеть квартирами',
        'Это зависит от провинции; в Пхукете запрет другой'
      ],
      correctAnswer: 1,
      explanation: 'Правило квоты: не более 49% жилой площади в многоквартирном доме может быть передано в собственность иностранцам; остальное — либо тайцам, либо оформляется как leasehold.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy4',
      question: 'Какие документы нужны для покупки кондоминиума иностранцем?',
      options: [
        'Только паспорт',
        'Паспорт, справка о переводе средств из-за границы (Foreign Exchange Transaction Form), документы на объект',
        'Визу и паспорт',
        'Никаких документов не нужно'
      ],
      correctAnswer: 1,
      explanation: 'Для покупки кондоминиума нужны: паспорт, справка о переводе средств из-за границы (Foreign Exchange Transaction Form), и все документы на объект от продавца.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy5',
      question: 'Сколько времени занимает процесс покупки недвижимости в Таиланде?',
      options: [
        '7-14 дней',
        'Обычно 30-60 дней от подписания договора до регистрации права',
        '3-6 месяцев',
        'Более 6 месяцев'
      ],
      correctAnswer: 1,
      explanation: 'Обычно процесс занимает 30-60 дней от подписания договора до регистрации права собственности в Земельном департаменте.',
      category: 'buying',
      difficulty: 'easy'
    },
    {
      id: 'buy6',
      question: 'Как правильно сформулировать клиенту условия leasehold в Таиланде (стандартный вариант)?',
      options: [
        'Leasehold — бессрочная собственность на землю',
        'Leasehold — долгосрочная аренда, стандартно 30 лет с возможностью двух продлений; часто используется иностранцами',
        'Leasehold обеспечивает право передачи и продажи земли в пределах 1 дня',
        'Leasehold запрещён законом'
      ],
      correctAnswer: 1,
      explanation: 'Leasehold - стандартная практика: лиз на 30 лет с опциями пролонгации; это один из наиболее практичных способов для иностранцев получить длительное право пользования землёй.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy7',
      question: 'Клиент — иностранец хочет купить квартиру в новом кондоминиуме. При предварительном разговоре клиент переводит вам, брокеру, что готов оплачивать банковским переводом из России. Что вы должны объяснить ему как важное условие для успешной регистрации прав в Land Office?',
      options: [
        'Главное — чтобы перевод прошёл любым способом, сроки регистрации не зависят от типа перевода',
        'Обязательно нужно сделать перевод таким образом, чтобы получить Foreign Exchange Transaction Form (FETF) от тайского банка — это потребуется для регистрации фрихолда у иностранца',
        'Для регистрации достаточно только оригинала паспорта — документы о переводе не нужны',
        'Рекомендуется переводить деньги через третьих лиц, чтобы уменьшить налоговую нагрузку'
      ],
      correctAnswer: 1,
      explanation: 'FETF — ключевой документ для регистрации права собственности иностранца (фрихолд). Land Office требует подтверждение легального ввоза иностранной валюты в Таиланд; получение FETF от тайского банка — стандартная практика. Без этого документа регистрацию фрихолда могут не провести.',
      category: 'buying',
      difficulty: 'hard'
    },
    {
      id: 'buy8',
      question: 'Перед регистрацией сделки в Land Office вы проверяете титул объекта. Какой документ считается «наиболее чистым» и надёжным титулом на землю, о котором вы говорите клиенту?',
      options: [
        'Простая справка от застройщика',
        'Chanote — титул высшего уровня, подтверждающий право на землю',
        'Устное подтверждение от продавца',
        'Копия договора аренды без записи в реестре'
      ],
      correctAnswer: 1,
      explanation: 'Chanote — это «самый чистый» тип титула, он чётко фиксирует границы и право собственности в земельном реестре. При поиске недвижимости и объяснении рисков клиенту нужно акцентировать внимание на наличии Chanote: это существенно снижает риск спорных прав на землю.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy9',
      question: 'Клиент подписал Reservation Agreement и внёс депозит. Какие пункты договора брони вы должны особенно проверить и объяснить клиенту?',
      options: [
        'Только срок брони — остальные пункты формальны и не важны',
        'Фиксация цены, данных объекта и этапа строительства; условия возврата депозита и штрафы при расторжении; пункты про форс-мажор и ответственность за задержки со стороны застройщика',
        'Только цена объекта',
        'Только условия возврата депозита'
      ],
      correctAnswer: 1,
      explanation: 'Reservation Agreement должен чётко фиксировать цену, точные данные объекта и стадию строительства; условия возврата депозита и штрафы — ключевой механизм защиты клиента; положения о форс-мажоре и ответственности за задержки позволяют заранее распределить риски.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy10',
      question: 'Клиент хочет минимизировать риск и предлагает переводить оплату через «независимого посредника», чтобы ускорить процедуру. Какой профессиональный совет вы даёте по схеме оплаты?',
      options: [
        'Согласиться — перекладываем риск на посредника',
        'Настоять на прозрачном банковском переводе напрямую на счёт продавца/застройщика и пояснить необходимость получения FETF; рассмотреть escrow, если возможно',
        'Перевести средства наличными при встрече с продавцом',
        'Предложить перевод через криптовалюту — быстрее и дешевле'
      ],
      correctAnswer: 1,
      explanation: 'Прозрачный банковский перевод оформляет происхождение средств и позволяет получить FETF — ключевой документ для регистрации фрихолда. Escrow — дополнительный инструмент защиты, если он применяется. Схемы через «посредников», наличные или крипто несут риски и часто не позволяют соблюсти формальности Land Office.',
      category: 'buying',
      difficulty: 'hard'
    },
    {
      id: 'buy11',
      question: 'Какие документы обязан подготовить покупатель-физлицо для регистрации сделки в Land Office?',
      options: [
        'Только оригинал заграничного паспорта',
        'Оригинал заграничного паспорта и нотариально заверенный перевод; FETF (при переводе иностранной валюты); подтверждение происхождения средств (банковские выписки)',
        'Только FETF',
        'Учредительные документы российского ООО (если покупка не через компанию, не нужны)'
      ],
      correctAnswer: 1,
      explanation: 'Оригинал паспорта предъявляется в Land Office; перевод паспорта на тайский должен быть нотариально заверенным. FETF подтверждает легальное введение иностранной валюты и часто требуется Land Office для регистрации фрихолда иностранца. Банковские выписки и документы о происхождении средств нужны для соблюдения банковских процедур.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy12',
      question: 'Продавец держал объект в собственности только 3 года и продаёт его иностранцу. Какой налог/сбор из тех, что мы обсуждали, с высокой вероятностью потребуется учитывать в расчётах?',
      options: [
        'Transfer fee 2% не применяется никогда',
        'Specific Business Tax (SBT) — применяется если срок владения продавца менее 5 лет',
        'Налога не будет, так как продавец — физлицо',
        'Только гербовый сбор, остальные налоги незначительны'
      ],
      correctAnswer: 1,
      explanation: 'Если продавец владел объектом менее 5 лет, то применяется Specific Business Tax (SBT) (приблизительно 3,3%). Это влияет на расчёт суммарных расходов при покупке и должно обсуждаться с клиентом заранее.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy13',
      question: 'В процессе due diligence вы проверяете историю застройщика. Какие риски вы закрываете этой проверкой?',
      options: [
        'Риск неверного расчёта ежегодного муниципального налога (Land and Building Tax)',
        'Риск юридической нечистоты титула (обременений); риск задержек строительства и судебных споров застройщика; риск отсутствия лицензии у девелопера и несоответствия разрешений',
        'Только риск задержек строительства',
        'Только риск отсутствия лицензии'
      ],
      correctAnswer: 1,
      explanation: 'Проверка титула и обременений показывает наличие ипотек, арестов и т. п. Анализ репутации застройщика выявляет ранее срывы сроков и судебные тяжбы. Проверка лицензии девелопера и разрешений на строительство показывает, законно ли ведётся проект.',
      category: 'buying',
      difficulty: 'hard'
    },
    {
      id: 'buy14',
      question: 'Клиенту важно максимально быстро получить жильё и он просит упустить этапы проверки, чтобы ускорить подписание SPA. Как вы должны среагировать как профессиональный брокер?',
      options: [
        'Согласиться — скорость важнее, риски в большинстве случаев не реализуются',
        'Объяснить важность due diligence и получить согласие клиента пройти минимально необходимую проверку (титул, квота, разрешения), зафиксировать это в договоре',
        'Подписать SPA без проверки и попросить клиента поставить подпись на всех документах позже',
        'Отказаться от клиента как "слишком нетерпеливого"'
      ],
      correctAnswer: 1,
      explanation: 'Due diligence — это юридическая страховка клиента; как профессионал вы обязаны объяснить риски и предложить минимально необходимую проверку (например, титул, отсутствие обременений, квота 49% для кондо, разрешения для строящегося объекта), а также прописать защитные условия в договоре.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy15',
      question: 'Какие документы продавца нужно запросить, чтобы убедиться, что у продавца есть право и полномочия на продажу объекта?',
      options: [
        'Только устное подтверждение по телефону от владельца',
        'Оригинал титула (Chanote / Unit Title Deed) и проверка на отсутствие обременений; разрешение на строительство (если это вилла/строящийся объект); лицензия девелопера (если продаёт застройщик)',
        'Только оригинал титула',
        'Только лицензия девелопера'
      ],
      correctAnswer: 1,
      explanation: 'Оригинал титула — главный документ, подтверждающий право собственности; проверка обременений показывает нет ли ипотек или арестов. Для виллы или строящегося объекта важно наличие Building Permit. Если продаёт застройщик, лицензия подтверждает его право на строительство и продажу.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy16',
      question: 'Покупатель — российская компания хочет купить кондо. Какие дополнительные документы потребуются от компании?',
      options: [
        'Ничего — компания действует как физлицо',
        'Учредительные документы (устав), список акционеров и решение директоров о покупке, заверенные переводы',
        'Только паспорт директора',
        'Документы не нужны, достаточно квитанций об оплате'
      ],
      correctAnswer: 1,
      explanation: 'Покупка через юрлицо требует предоставления учредительных документов, списка акционеров и корпоративного решения о приобретении — это подтверждает полномочия компании на покупку и требуется банками/Land Office при регистрации. Переводы этих документов на тайский и нотариальное заверение повышают скорость регистрации.',
      category: 'buying',
      difficulty: 'hard'
    },
    {
      id: 'buy17',
      question: 'Клиент интересуется: «Если в кондо уже занята квота 49% для иностранцев, можно ли всё равно оформить фрихолд?» Ваш корректный ответ:',
      options: [
        'Да, можно — квота не обязательна',
        'Нет — если квота исчерпана, покупка фрихолда невозможна; рассматриваем лизхолд или другой объект',
        'Можно, если оформить покупку через тайскую компанию, это обходит квоту в 100% случаев',
        'Можно оформить фрихолд, если доказать, что вы будете проживать в кондо круглогодично'
      ],
      correctAnswer: 1,
      explanation: 'В кондоминиумах действует правило: не более 49% площади здания в собственности иностранцев для фрихолда. Если квота исчерпана, иностранцу обычно предлагают оформление лизхолда либо поиск другого здания с доступной долей фрихолда.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy18',
      question: 'Что необходимо обязательно проверить в переводах документов перед регистрацией?',
      options: [
        'Ничего — перевод можно сделать и после регистрации',
        'Переводы паспортов/документов должны быть нотариально заверены и без ошибок — неточности приведут к задержке регистрации',
        'Достаточно рукописного перевода',
        'Можно использовать машинный перевод, заверять не нужно'
      ],
      correctAnswer: 1,
      explanation: 'Ошибки в переводах или отсутствие нотариального заверения приводят к задержкам в Land Office и рискам отказа в регистрации. Поэтому необходимо заранее подготовить корректные нотариально заверенные переводы ключевых документов (паспорт, учредительные документы и т. п.).',
      category: 'buying',
      difficulty: 'easy'
    },
    {
      id: 'buy19',
      question: 'Клиент задаёт вопрос: «Поможет ли покупка недвижимости автоматически получить вид на жительство (ВНЖ) в Таиланде?» Как вы формулируете ответ?',
      options: [
        'Да, покупка любого объекта автоматически даёт ВНЖ',
        'Нет — покупка не даёт автоматического ВНЖ; нужно обсуждать отдельные визовые опции (Thailand Elite, LTR и т. п.)',
        'Частично — если объект стоит более определённой суммы, ВНЖ приходит автоматически',
        'Можно получить ВНЖ через покупку, но только если оформлять через тайскую компанию'
      ],
      correctAnswer: 1,
      explanation: 'Покупка недвижимости сама по себе не даёт автоматического права на проживание. Существуют отдельные визовые программы (Thailand Elite, LTR, SMART и т. д.), которые могут учитывать инвестиции, но это отдельная процедура. Как брокер вы должны параллельно обсуждать визовую стратегию с клиентом, если он планирует переезд.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy20',
      question: 'В контракте купли-продажи (SPA) клиент просит «не указывать сроки и не прописывать штрафы» чтобы всё выглядело проще. Какой ваш профессиональный подход?',
      options: [
        'Выполнить просьбу — простота повысит скорость подписания',
        'Настоять на чётком прописывании сроков передачи, условий ответственности и штрафных санкций за нарушение — это защитит интересы покупателя',
        'Сказать, что сроки и штрафы не имеют значения — рынок стабильный',
        'Отправить клиента к юристу и не участвовать в переговорах'
      ],
      correctAnswer: 1,
      explanation: 'Чётко прописанные сроки и ответственность — ключевой элемент защиты покупателя (и продавца). Пункты о штрафах за задержки и условиях возврата депозита предотвращают потери и недопонимания. Как брокер вы обязаны объяснить клиенту важность этих положений и добиваться их включения.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy21',
      question: 'На этапе due diligence вы обнаружили, что в документах на землю есть запись об ипотеке. Что вы делаете дальше?',
      options: [
        'Идёте дальше, ничего не меняя — ипотека не важна',
        'Просите продавца предоставить документы о погашении/снятии обременения или план его погашения до/в момент регистрации; учитываете это в договоре',
        'Отказываете клиенту от покупки без объяснений',
        'Платите ипотеку вместо продавца, чтобы ускорить сделку'
      ],
      correctAnswer: 1,
      explanation: 'Наличие ипотечного обременения — серьёзный риск: без его снятия покупатель не получит чистого титула. Правильная практика — требовать документально подтверждённое снятие обременения до регистрации или предусмотреть в SPA механизм погашения и снятия залога.',
      category: 'buying',
      difficulty: 'hard'
    },
    {
      id: 'buy22',
      question: 'Клиент хочет сравнить варианты финансирования: ипотека от тайского банка (через MBK) и рассрочка от застройщика. Что вы отмечаете как важные моменты при разговоре?',
      options: [
        'Ипотека всегда выгоднее и доступна каждому иностранцу без документов',
        'Большинство тайских банков не кредитуют нерезидентов — MBK и подобные организации могут быть исключением; рассрочка от застройщика часто удобнее для иностранца и может быть беспроцентной на период строительства; нужно проанализировать LTV, ставки, сроки и наличие гарантии от застройщика',
        'Только рассрочка от застройщика',
        'Только ипотека от тайского банка'
      ],
      correctAnswer: 1,
      explanation: 'Традиционные тайские банки обычно кредитуют резидентов; для нерезидентов доступны ограниченные опции (например, MBK). Рассрочка от застройщика — распространённая и удобная схема для иностранцев. Сравнение предполагает анализ LTV, процентных ставок, сроков и условий гарантий.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy23',
      question: 'Какие пункты нужно обязательно обсудить с клиентом при подготовке к регистрации сделки, чтобы избежать последующих конфликтов?',
      options: [
        'Только условия восстановления мебели в квартире — это ключевой вопрос',
        'Кто оплачивает трансфер фи и другие регистрационные сборы; какова налоговая нагрузка; порядок перевода денег и документальное подтверждение (FETF, банковские выписки); детали о возможном наследовании и структуре владения (особенно если через компанию)',
        'Только порядок перевода денег',
        'Только налоговую нагрузку'
      ],
      correctAnswer: 1,
      explanation: 'Вопрос распределения платежей (transfer fee, stamp duty, SBT и т. д.) критичен — он влияет на итоговую сумму сделки. Порядок перевода денег, получение FETF и подтверждений банковских операций — обязательные элементы для регистрации. Если покупка через компанию или если нужна планировка наследования, это должно быть оговорено заранее.',
      category: 'buying',
      difficulty: 'hard'
    },
    {
      id: 'buy24',
      question: 'Клиент спрашивает про Escrow: «Нужно ли использовать?» Какой ваш профессиональный ответ?',
      options: [
        'Escrow — излишняя формальность, не нужна',
        'Escrow — полезный механизм хранения средств у третьей стороны; целесообразен для защиты покупателя при высоких рисках или спорных застройщиках',
        'Escrow заменяет необходимость регистрации в Land Office',
        'Escrow применяется только в Тайланде для аренды автомобилей'
      ],
      correctAnswer: 1,
      explanation: 'Escrow — договор о хранении средств у третьей стороны, он защищает покупателя в ситуациях, когда есть риск несоблюдения договорённостей со стороны продавца/застройщика. Это дополнительный уровень безопасности, особенно в проектах с сомнительной репутацией. Escrow не заменяет регистрацию в Land Office — он только защищает передачу средств.',
      category: 'buying',
      difficulty: 'medium'
    },
    {
      id: 'buy25',
      question: 'Какой набор минимальных документов вы бы рекомендовали клиенту-физлицу подготовить заранее, прежде чем начать смотреть объекты?',
      options: [
        'Учредительные документы российской компании, даже если покупатель — физлицо',
        'Действующий заграничный паспорт (срок действия минимум 6 месяцев); банковские выписки и документы, подтверждающие происхождение средств; планируемые механизмы перевода (чтобы получить FETF); контакт юриста и список вопросов по визовой стратегии (если клиент планирует переезд)',
        'Только паспорт',
        'Только банковские выписки'
      ],
      correctAnswer: 1,
      explanation: 'Паспорт с достаточным сроком действия требуется на всех ключевых этапах. Подготовленные банковские выписки и подтверждения происхождения средств ускоряют процесс и позволяют корректно оформить переводы (получить FETF). Если покупатель планирует переезд, важно обсудить визовую стратегию параллельно с покупкой.',
      category: 'buying',
      difficulty: 'medium'
    },

    // Урок 3: Инвестиции
    {
      id: 'inv1',
      question: 'Какая средняя доходность от аренды в Таиланде?',
      options: [
        '2-3% годовых',
        '5-8% годовых в зависимости от типа объекта и локации',
        '10-12% годовых',
        '15-20% годовых'
      ],
      correctAnswer: 1,
      explanation: 'Средняя доходность от аренды составляет 5-8% годовых. Зависит от типа объекта (кондоминиум, вилла), локации и сезона.',
      category: 'investment',
      difficulty: 'medium'
    },
    {
      id: 'inv2',
      question: 'Как рассчитать ROI для недвижимости?',
      options: [
        'ROI = Стоимость / Доход',
        'ROI = (Годовой доход от аренды / Стоимость покупки) × 100%',
        'ROI = Доход × Стоимость',
        'ROI не рассчитывается'
      ],
      correctAnswer: 1,
      explanation: 'ROI (Return on Investment) = (Годовой доход от аренды / Стоимость покупки) × 100%. Это основной показатель доходности инвестиций.',
      category: 'investment',
      difficulty: 'hard'
    },
    {
      id: 'inv3',
      question: 'Инвестор хочет максимально увеличить вероятность быстрой перепродажи и прироста капитала через 12–24 месяца. Какой рабочий совет вы даёте?',
      options: [
        'Искать готовые дешёвые студии в удалённых районах',
        'Покупать на ранних стадиях строительства (off-plan) в популярных проектах',
        'Брать лиземолд (leasehold) только — он дешевле и быстрее продаётся',
        'Инвестировать только в виллы вне курортов'
      ],
      correctAnswer: 1,
      explanation: 'В Бангкоке и курортных проектах типичная стратегия — покупка на ранней стадии и продажа по завершении; в ряде случаев ценовой рост в период строительства может быть значительным (в Пхукете — до ~30% при покупке off-plan).',
      category: 'investment',
      difficulty: 'hard'
    },
    {
      id: 'inv4',
      question: 'Клиент интересуется, почему "rental pool" часто даёт ниже чистую доходность, чем выглядит по брошюре. Какие факторы чаще всего съедают доход?',
      options: [
        'Высокие комиссии управляющей компании (30–40%)',
        'Налог на продажу (specific business tax) при продаже в пределах 5 лет',
        'Неполная заполненность (seasonality) и простои',
        'Блокчейн-комиссии при оплате криптовалютой'
      ],
      correctAnswer: 0,
      explanation: 'В пуле аренды управленческая комиссия часто составляет 30–40% от выручки; кроме того сезонность и простои резко сокращают налогооблагаемую базу и фактический чек владельца.',
      category: 'investment',
      difficulty: 'hard'
    },
    {
      id: 'inv5',
      question: 'Клиент — семья с детьми, планирует сдавать объект в аренду долгосрочно и параллельно использовать для собственных поездок 2–3 раза в год. Что будет оптимальным вариантом для них?',
      options: [
        'Студия в туристическом районе у пляжа',
        'Апартаменты с двумя спальнями в комплексе с инфраструктурой (бассейн, охрана, детская площадка)',
        'Вилла в сельской местности без управляющей компании',
        'Офисное помещение в центре Бангкока'
      ],
      correctAnswer: 1,
      explanation: 'Двухспальные апартаменты в жилом комплексе удобны для семьи, востребованы у арендаторов и позволяют сочетать сдачу и личное использование. Кроме того, наличие инфраструктуры увеличивает привлекательность и ликвидность объекта.',
      category: 'investment',
      difficulty: 'medium'
    },
    {
      id: 'inv6',
      question: 'Инвестор предлагает: "Гарантированная 6% годовых на 5 лет — это откровенно плохо". Как вы аргументированно отвечаете?',
      options: [
        'Согласен — 6% слишком мало для Таиланда',
        'Нет — гарантированная доходность даёт защиту от сезонных рисков и простоев; для пассивного инвестора это логично',
        'Нужно требовать 12% гарантии для безопасности',
        'Отправлять клиента на фондовый рынок — там стабильнее'
      ],
      correctAnswer: 1,
      explanation: 'Гарантия переводит риск операционной части (бронирования, обслуживания) на менеджера/застройщика; это ценность для пассивного инвестора. Гарантии 5–7% — распространённое предложение в курортных проектах.',
      category: 'investment',
      difficulty: 'medium'
    },
    {
      id: 'inv7',
      question: 'Клиент хочет купить и перепродать в течение 4 лет. Какой налог/плата наиболее критичен при перепродаже в этот срок?',
      options: [
        'Stamp duty 0.5% — единственный налог',
        'Specific business tax (3.3%) заменит stamp duty, если продали менее чем через 5 лет',
        'Налог на землю 10% от продажи',
        'Налог не применяется, если поместить собственность на тайскую компанию'
      ],
      correctAnswer: 1,
      explanation: 'При продаже freehold недвижимости в Таиланде в течение 5 лет применяется specific business tax 3.3% вместо stamp duty; это важный фактор расчёта чистой прибыли при коротких сроках владения.',
      category: 'investment',
      difficulty: 'hard'
    },
    {
      id: 'inv8',
      question: 'Клиент спрашивает про валютный риск: если доходы от аренды номинированы в THB, а инвестор отчёты ведёт в USD, что произойдёт при укреплении бата на 7% за год? Как это повлияет на доходность в USD?',
      options: [
        'Никак — валюты не влияют на доходность',
        'USD-доход уменьшится на ~7%',
        'USD-доход увеличится примерно на 7% (в дополнение к локальной доходности в THB)',
        'Нужно переводить доход в EUR, чтобы снизить риск'
      ],
      correctAnswer: 2,
      explanation: 'Если доход в THB конвертируется в USD, и бат укрепился на 7% vs USD, то при прочих равных итоговая сумма в USD вырастет примерно на 7%. В 2025 году бат укреплялся порядка 7–10% к доллару — это важный доп. фактор доходности.',
      category: 'investment',
      difficulty: 'hard'
    },
    {
      id: 'inv9',
      question: 'Клиент владеет виллой на острове и хочет одновременно использовать её для семейного отдыха и сдачи в аренду пару недель в год. Какой продукт/модель вы предложите?',
      options: [
        'Инвестиционная вилла в составе организованного комплекса с управляющей компанией (owner-use + rental program)',
        'Консервативная покупка офф-плана без управления',
        'Покупка частного участка вне комплекса',
        'Искать гостиничный номер (hotel unit) без прав использования'
      ],
      correctAnswer: 0,
      explanation: 'Инвесторы, желающие сочетать семейный отдых и доход, чаще выбирают объекты с организованной арендой и сервисами — это сокращает управление и даёт "owner weeks" (бонусы для владельцев).',
      category: 'investment',
      difficulty: 'medium'
    },
    {
      id: 'inv10',
      question: 'Покупка: $110,000; гарантированная доходность 5% годовых в течение 3 лет. Сколько инвестор получит ежегодно и в сумме за 3 года (без капитализации)?',
      options: [
        '$5,000 ежегодно; $15,000 за 3 года',
        '$5,500 ежегодно; $16,500 за 3 года',
        '$11,000 ежегодно; $33,000 за 3 года',
        'Невозможно посчитать'
      ],
      correctAnswer: 1,
      explanation: 'Ежегодный доход = $110,000 × 0.05 = $5,500. За 3 года (без реинвестирования) = $5,500 × 3 = $16,500.',
      category: 'investment',
      difficulty: 'medium'
    },
    {
      id: 'inv11',
      question: 'Off-plan: купили за $200,000; в период строительства цена выросла на 30%. Каков абсолютный прирост в $ и какой будет потенциальный доход до налогов при быстрой перепродаже? Затем вычтите specific business tax 3.3% (предположим, он рассчитывается от контрактной цены $200,000).',
      options: [
        'Прирост $60,000; налог $6,600; чистый ≈ $53,400',
        'Прирост $30,000; налог $6,600; чистый ≈ $23,400',
        'Прирост $60,000; налог $0; чистый $60,000',
        'Неверно всё'
      ],
      correctAnswer: 0,
      explanation: 'Прирост = $200,000 × 0.30 = $60,000. Specific business tax = $200,000 × 0.033 = $6,600 (если продажа в пределах 5 лет). Чистый прирост ≈ $60,000 − $6,600 = $53,400.',
      category: 'investment',
      difficulty: 'hard'
    },
    {
      id: 'inv12',
      question: 'Объявленная доходность объекта — 10% годовых при 100% заполняемости. Реальная заполняемость — 65%, управляющая компания удерживает 25% от выручки. Стоимость объекта $250,000. Какова реальная доходность?',
      options: [
        '~4.9%',
        '~6.0%',
        '~3.6%',
        '~2.0%'
      ],
      correctAnswer: 0,
      explanation: 'Гросс-доход = $250,000 × 10% = $25,000. С учётом заполняемости 65% = $25,000 × 0.65 = $16,250. После комиссии 25% = $16,250 × 0.75 = $12,187.50. Чистая доходность = $12,187.50 ÷ $250,000 = 0.04875 → ≈ 4.9%.',
      category: 'investment',
      difficulty: 'hard'
    },
    {
      id: 'inv13',
      question: 'Если цель инвестора — снизить сезонность дохода от аренды, какой регион или формат недвижимости лучше рассмотреть?',
      options: [
        'Города с университетами и деловой активностью',
        'Малые курортные острова, куда можно добраться только паромом',
        'Сельские районы вдали от туристических потоков',
        'Туристические деревни с одной высокой сезонностью'
      ],
      correctAnswer: 0,
      explanation: 'В городах с деловой и образовательной активностью аренда менее зависима от сезона, спрос поддерживается за счёт студентов, специалистов и постоянного потока жителей, а не только туристов.',
      category: 'investment',
      difficulty: 'medium'
    },
    {
      id: 'inv14',
      question: 'Какая из следующих формулировок лучше отражает практику финансирования девелоперов в Пхукете и её влияние на инвесторов off-plan?',
      options: [
        'Девелоперы в Пхукете активно берут банковские кредиты на 80% стоимости — это повышает риски',
        'Девелоперы редко полагаются на банковские кредиты; значительная часть финансирования идёт из предоплат покупателей, что даёт бонусы ранним покупателям (возможен рост цены до ~30% на фазе строительства)',
        'Застройщики продают проекты только после окончания строительства',
        'Девелоперы в Пхукете обязаны отдать 51% акций тайским инвесторам по закону'
      ],
      correctAnswer: 1,
      explanation: 'Многие проекты в Пхукете финансируются из собственных средств застройщика и предоплат покупателей, что создаёт потенциал значительной премии для ранних инвесторов (до ≈30% в период строительства).',
      category: 'investment',
      difficulty: 'hard'
    },
    {
      id: 'inv15',
      question: 'Клиент говорит: "Я хочу вложиться в апартаменты у моря и рассчитываю на высокую доходность. Но слышал, что чем ближе объект к пляжу, тем выше прибыль. Это так?"',
      options: [
        'Да, чем ближе объект к морю, тем выше арендная ставка и доходность всегда',
        'Нет, расстояние до моря не играет роли, важнее цена покупки',
        'Близость к морю повышает спрос и ставки аренды, но итоговая доходность зависит ещё и от стоимости входа, уровня конкуренции и качества сервиса в объекте',
        'Лучше покупать только виллу у моря — это всегда более выгодно, чем апартаменты'
      ],
      correctAnswer: 2,
      explanation: 'На рынке Таиланда арендаторы действительно ценят вид на море и доступ к пляжу, но высокая цена покупки таких объектов может снизить процентную доходность. Кроме того, у морской линии часто высокая конкуренция среди схожих предложений.',
      category: 'investment',
      difficulty: 'hard'
    },
    {
      id: 'inv16',
      question: 'Инвестор хочет попасть в сегмент "premium long-stay" (пенсионеры / долгосрочные туристы). Какой фактор наиболее критичен при выборе локации?',
      options: [
        'Наличие международного аэропорта и развитой инфраструктуры (медицинские услуги, школы, связь)',
        'Близость к клубам ночной жизни',
        'Отсутствие правил владения для иностранцев',
        'Низкая цена за м² независимо от инфраструктуры'
      ],
      correctAnswer: 0,
      explanation: 'Premium long-stay сегмент ориентирован на качество туризма, доступность (аэропорты) и высокую инфраструктурную обеспеченность — это ключ к стабильной долгосрочной аренде и росту спроса.',
      category: 'investment',
      difficulty: 'medium'
    },

    // Урок 4: Жизнь в Таиланде
    {
      id: 'life1',
      question: 'Клиент планирует приехать на Пхукет, чтобы выбрать квартиру и оценить остров "в удачное время года" — он просит порекомендовать оптимальные месяцы: когда приезжать, чтобы увидеть зелёный остров, меньше туристов и при этом комфортная погода?',
      options: [
        'Март — май',
        'Ноябрь — февраль',
        'Сентябрь — ноябрь',
        'Июнь — август'
      ],
      correctAnswer: 2,
      explanation: 'По региональной климатике Пхукета "бархатный сезон" традиционно приходится на сентябрь—ноябрь — это время, когда остров остаётся зелёным после дождей, поток массового туризма снижается по сравнению с пиком (декабрь–февраль), а кратковременные ливни чаще идут по ночам или ранним утром.',
      category: 'life',
      difficulty: 'medium'
    },
    {
      id: 'life2',
      question: 'Клиент — пожилой родственник покупателя, боится комаров и возможных инфекций. Что из перечисленного наиболее корректно объяснить клиенту при выборе региона в Таиланде?',
      options: [
        'Малярия — повсеместная проблема по всей стране; от неё нужно защищаться везде одинаково',
        'Малярия в Таиланде не является существенной проблемой в большинстве районов',
        'Комаров в Таиланде почти нет, поэтому переживать не о чем',
        'Влажный климат на севере безопаснее по отношению к энцефалиту, чем на юге'
      ],
      correctAnswer: 1,
      explanation: 'Малярия не является повсеместной серьёзной проблемой — она локализована главным образом в приграничных районах; при этом японский энцефалит фиксируется в северных и центральных регионах.',
      category: 'life',
      difficulty: 'medium'
    },
    {
      id: 'life3',
      question: 'Клиент спрашивает: "А правда ли, что медицина в Таиланде на уровне и стоит ли рассчитывать на private hospitals?" Отметьте корректные утверждения:',
      options: [
        'В Таиланде около 59 частных госпиталей аккредитовано JCI — частные клиники соответствуют международным стандартам',
        'Государственные госпитали обслуживают граждан бесплатно; иностранцы получают бесплатную помощь только в рамках Social Security при трудоустройстве',
        'Bumrungrad — крупнейший международный госпиталь региона, с высокой репутацией и большим потоком иностранных пациентов',
        'Суточная стоимость пребывания в лучшей клинике (Bumrungrad) ориентировочно ~$510, в клиниках Пхукета/Паттайи — около $200'
      ],
      correctAnswer: 0,
      explanation: 'В Таиланде много частных клиник высокого уровня, значительная доля аккредитована JCI; государственная система обслуживает граждан бесплатно, иностранцы — платно, если только не покрываются через соцстрахование.',
      category: 'life',
      difficulty: 'hard'
    },
    {
      id: 'life4',
      question: 'Клиент планирует "медицинский туризм" (комплексная диагностика) и спрашивает, стоит ли выбирать Пхукет для check-up: какой из вариантов отражает реальность?',
      options: [
        'На Пхукете нет возможностей для комплексного "check up" — нужно лететь в Бангкок',
        'Сети частных госпиталей на Пхукете (филиалы BDMS и др.) предлагают пакетные "check up" — полный диагностический цикл за 1 день',
        'На Пхукете проводят только малоинвазивные процедуры, серьёзная хирургия недоступна',
        'Медицинские услуги на Пхукете дороже, чем в Бангкоке во всех случаях'
      ],
      correctAnswer: 1,
      explanation: 'На Пхукете есть филиалы крупных частных сетей, которые практикуют одно-дневные пакеты check-up с быстрым получением результатов — это важный плюс для зарубежных клиентов.',
      category: 'life',
      difficulty: 'medium'
    },
    {
      id: 'life5',
      question: 'Клиенты — семья с ребёнком 10 лет, нацелены на британскую/международную программу и хотят школу рядом с удобной транспортной доступностью. Какую школу на Пхукете брокер порекомендует как наиболее соответствующую запросу?',
      options: [
        'British International School Phuket (BISP), кампус у Чалонга',
        'Lycée Français International de Phuket',
        'Russian International School Phuket',
        'Oak Meadow'
      ],
      correctAnswer: 0,
      explanation: 'Для семьи, ориентированной на британскую/международную траекторию, BISP — очевидный выбор: классические британские стандарты с подготовкой к IGCSE и IBDP, развитая инфраструктура и расположение вблизи Чалонга.',
      category: 'life',
      difficulty: 'medium'
    },
    {
      id: 'life6',
      question: 'Клиент интересуется: "В каком районе Пхукета сосредоточено наибольшее количество международных школ (важно для логистики поездок детей)?"',
      options: [
        'Патонг',
        'Чалонг',
        'Раваи',
        'Бан Тао'
      ],
      correctAnswer: 1,
      explanation: 'Большинство международных школ сконцентрировано в районе Чалонг — это делает его логистическим центром для семей, желающих жить в разных частях острова и при этом иметь удобный доступ к учебным заведениям.',
      category: 'life',
      difficulty: 'easy'
    },
    {
      id: 'life7',
      question: 'Клиент-инвестор хочет сэкономить на отпуске и спросил, когда дешевле всего приезжать в Таиланд: какой вариант наиболее корректен?',
      options: [
        'Сухой сезон (ноябрь–февраль)',
        'Жаркий сезон (март–май)',
        'Сезон дождей (июнь–октябрь)',
        'В межсезонье цены не меняются'
      ],
      correctAnswer: 2,
      explanation: 'Минимальная стоимость тура заметно ниже в сезон дождей или в периоды сильной жары, поскольку снижается туристический спрос. Для инвестора-владельца жилья это значит: при расчёте доходности краткосрочной аренды учитывать сезонное снижение загрузки.',
      category: 'life',
      difficulty: 'easy'
    },
    {
      id: 'life8',
      question: 'Клиент интересуется логистикой: "Если у меня нет времени на внутренний перелёт — возможна ли наземная поездка из Бангкока на Пхукет?" Какой ответ корректен с точки зрения времени в пути?',
      options: [
        'Поездка на автобусе займёт примерно 12 часов',
        'На автобусе до Пхукета добраться за 4–5 часов',
        'Нельзя добраться на автобусе; только самолёт',
        'На автобусе путь займёт не менее 24 часов'
      ],
      correctAnswer: 0,
      explanation: 'Между Бангкоком и Пхукетом действует автобусное сообщение и дорога занимает в районе 12 часов — полезно для клиентов, у которых ограничен бюджет или кто рассматривает вариант "долгоостановочного переезда" с багажом.',
      category: 'life',
      difficulty: 'easy'
    },
    {
      id: 'life9',
      question: 'Клиент-инвестор рассматривает объект на Самуи и хочет знать влияние локальной сезонности на доходность краткосрочной аренды. Что важнее учесть?',
      options: [
        'Сезон дождей на Самуи обычно выпадает в июле—сентябре, и это может снизить загрузку',
        'Сезон дождей на Самуи совпадает с Пхукетом (сентябрь—ноябрь) - влияет не значительно на загрузку',
        'На Самуи дождливые месяцы не влияют на туристический поток',
        'Сезонности нет — Самуи стабильно загружен весь год'
      ],
      correctAnswer: 0,
      explanation: 'Климатические циклы по островам различаются: У Самуи влажный период имеет свою специфику (летние месяцы), поэтому прогноз доходности нужно строить с учётом локального календаря загрузок.',
      category: 'life',
      difficulty: 'medium'
    },
    {
      id: 'life10',
      question: 'Как обстоит дело с отпускаемыми средствами (например, антибиотиками) в Таиланде?',
      options: [
        'В Таиланде антибиотики отпускаются строго по рецепту и это универсально',
        'Антибиотики в Таиланде часто можно купить без рецепта — OTC-доступность выше, чем в Европе',
        'В Таиланде антибиотики полностью запрещены для продажи аптекой',
        'Антибиотики можно получать только в госпитале бесплатно'
      ],
      correctAnswer: 1,
      explanation: 'В Таиланде можно приобрести лекарства первой необходимости, включая антибиотики, без рецепта; это удобно туристам, но требует осторожности — брокеру полезно предупреждать клиентов про необходимость консультации врача и наличие страховки.',
      category: 'life',
      difficulty: 'easy'
    },
    {
      id: 'life11',
      question: 'Культурный аспект: Full Moon Party (остров Панган) — как рекомендовать его семейным клиентам?',
      options: [
        'Это событийное мероприятие, масштабная вечеринка с ночной тусовкой — не самое подходящее для семей с маленькими детьми',
        'Это спокойный семейный фестиваль с детскими зонами',
        'Это официальный религиозный праздник, требующий уважения и соблюдения традиций',
        'Это закрытое мероприятие только для резидентов Таиланда'
      ],
      correctAnswer: 0,
      explanation: 'Full Moon Party как крупное музыкальное событие с международной аудиторией — массовые вечеринки, ночная жизнь и высокий шумовой уровень; для семейных клиентов это повод рекомендовать альтернативные, более спокойные развлечения.',
      category: 'life',
      difficulty: 'easy'
    },
    {
      id: 'life12',
      question: 'В чём практическая коммерческая ценность "бархатного сезона" для владельца курортной недвижимости?',
      options: [
        'Никто не приезжает, поэтому всё работает хуже, чем в высокий сезон',
        'Это время более благоприятной погоды с меньшим потоком туристов, часто — выгодные ценовые предложения и более "зелёный" пейзаж; подходит для просмотров и переговоров с покупателями',
        'Сезон равнозначен пиковому по доходности',
        'Бархатный сезон — маркетинговый миф, не влияющий на операции'
      ],
      correctAnswer: 1,
      explanation: 'С точки зрения продаж, бархатный сезон сочетает в себе преимущество комфортной погоды и меньшего наплыва туристов, что позволяет демонстрировать объекты в более спокойной обстановке и чаще договариваться о лучших условиях.',
      category: 'life',
      difficulty: 'medium'
    },
    {
      id: 'life13',
      question: 'Утверждение: "На Самуи пик сезонных дождей и влажный период выпадают на июль—сентябрь" — верно или неверно?',
      options: [
        'Верно',
        'Неверно — на Самуи сезон дождей в декабре—январе',
        'Неверно — на Самуи дождей никогда не бывает',
        'Неверно — сезон дождей там совпадает с Бангкоком в апреле'
      ],
      correctAnswer: 0,
      explanation: 'У Самуи влажный период приходится на середину лета — это важно для таргетирования аренды и сроков строительства/завершения отделочных работ.',
      category: 'life',
      difficulty: 'medium'
    },
    {
      id: 'life14',
      question: 'На Пхукете есть школа с российской программой "Рассвет" — верно ли это и что даёт такое наличие для российских семей?',
      options: [
        'Неверно — российских программ в Таиланде нет',
        'Верно — школа "Рассвет" существует; это опция для семей из России на адаптационный период',
        'Школа "Рассвет" — это единственная международная школа на Пхукете',
        '"Рассвет" — это сеть государственных тайских школ'
      ],
      correctAnswer: 1,
      explanation: 'Наличие русскоязычных образовательных опций на Пхукете (школа "Рассвет"), облегчает адаптацию семей из России и может быть ключевым аргументом при продаже недвижимости семье.',
      category: 'life',
      difficulty: 'easy'
    },
    {
      id: 'life15',
      question: 'Как позиционируется Таиланд в сфере медицинского туризма?',
      options: [
        'Таиланд незначительно представлен в медицинском туризме',
        'Таиланд входит в топ стран по качеству здравоохранения и занимает высокие позиции в рейтингах популярности среди стран для медицинского туризма',
        'Таиланд — место только для дешёвых процедур низкого качества',
        'Медицинский туризм в Таиланде запрещён международными нормами'
      ],
      correctAnswer: 1,
      explanation: 'Таиланд занимает высокие места по качеству здравоохранения и отмечается как весьма популярное направление медицинского туризма — это мощный аргумент для клиентов.',
      category: 'life',
      difficulty: 'easy'
    },
    {
      id: 'life16',
      question: 'Можно ли проживать иностранцам в Таиланде без постоянного ВНЖ?',
      options: [
        'В Таиланде невозможно проживать дольше 30 дней, даже при продлении',
        'Существуют визы для долгосрочного пребывания — например, Long-Term Resident (LTR), Retirement Visa, Education Visa',
        'После 60 дней пребывания иностранца обязаны депортировать',
        'Виза не нужна, если вы покупаете недвижимость'
      ],
      correctAnswer: 1,
      explanation: 'В Таиланде разработаны разные визовые категории: LTR Visa (до 10 лет для инвесторов и профессионалов), Retirement Visa (для пенсионеров 50+), Education Visa и др.',
      category: 'life',
      difficulty: 'medium'
    },
    {
      id: 'life17',
      question: 'Какова средняя стоимость коммунальных услуг (электричество, вода, интернет) для квартиры на Пхукете площадью около 40 м²?',
      options: [
        'Около $30–50 в месяц',
        '$200–300 в месяц',
        'Коммунальные услуги бесплатны для владельцев недвижимости',
        'Только интернет оплачивается, вода и электричество включены в налог'
      ],
      correctAnswer: 0,
      explanation: 'Коммунальные платежи в Таиланде относительно невысокие — электричество ~$0.12–0.15/кВт·ч, вода ~$0.5/м³, интернет ~$15–20/мес. Это аргумент в пользу низкой стоимости содержания жилья.',
      category: 'life',
      difficulty: 'easy'
    },
    {
      id: 'life18',
      question: 'Как обстоит дело с безопасностью и уровнем преступности в Таиланде?',
      options: [
        'Таиланд считается одной из наиболее безопасных стран региона, особенно туристические и курортные зоны',
        'Уровень преступности высок, и иностранцам рекомендуется избегать курортов',
        'На Пхукете часто происходят массовые беспорядки',
        'Преступность в Таиланде выше, чем в Европе'
      ],
      correctAnswer: 0,
      explanation: 'По международным рейтингам безопасности, Таиланд стабильно демонстрирует низкий уровень насильственной преступности; на курортах — высокий уровень полицейского контроля.',
      category: 'life',
      difficulty: 'easy'
    },
    {
      id: 'life19',
      question: 'Какова разница во времени между Таиландом и Москвой?',
      options: [
        'Таиланд отстаёт на 4 часа',
        'Таиланд опережает Москву на 4 часа',
        'Таиланд опережает Москву на 8 часов',
        'Время совпадает'
      ],
      correctAnswer: 1,
      explanation: 'Таиланд живёт по часовому поясу GMT+7 и не использует переход на летнее/зимнее время. Москва — GMT+3, разница — +4 часа вперёд.',
      category: 'life',
      difficulty: 'easy'
    },
    {
      id: 'life20',
      question: 'Какова реальная стоимость жизни в Таиланде по сравнению с Европой при сохранении сопоставимого уровня комфорта?',
      options: [
        'На 10–20% выше, чем в Европе',
        'Примерно такая же',
        'В среднем на 30–50% дешевле, чем в странах Европы',
        'Существенно дороже, чем в США и ЕС'
      ],
      correctAnswer: 2,
      explanation: 'Стоимость жизни в Таиланде — одна из ключевых причин переезда экспатов. При качественном жилье, страховании и хорошем питании бюджет семьи на 30–50% ниже, чем в Европе, без потери уровня комфорта.',
      category: 'life',
      difficulty: 'medium'
    },

    // Урок 5: ВНЖ и гражданство
    {
      id: 'visa1',
      question: 'Может ли покупка недвижимости в Таиланде автоматически дать право на получение ВНЖ?',
      options: [
        'Да, покупка недвижимости автоматически даёт ВНЖ',
        'Нет, покупка недвижимости не даёт автоматического права на ВНЖ, но может быть учтена при подаче на некоторые типы виз',
        'Только если купить недвижимость стоимостью более $1 млн',
        'Только для граждан ЕС'
      ],
      correctAnswer: 1,
      explanation: 'Покупка недвижимости сама по себе не даёт автоматического права на ВНЖ, но может быть учтена при подаче на некоторые типы виз, например, Long-Term Resident (LTR) Visa для инвесторов.',
      category: 'visa',
      difficulty: 'medium'
    },
    {
      id: 'visa2',
      question: 'Какие основные типы долгосрочных виз доступны для иностранцев в Таиланде?',
      options: [
        'Только туристическая виза на 30 дней',
        'Long-Term Resident (LTR) Visa, Retirement Visa (для 50+), Education Visa, Elite Visa',
        'Только рабочая виза',
        'Визы не нужны, если есть недвижимость'
      ],
      correctAnswer: 1,
      explanation: 'Основные типы долгосрочных виз: LTR Visa (до 10 лет для инвесторов и профессионалов), Retirement Visa (для пенсионеров 50+), Education Visa, Elite Visa (премиум-программа).',
      category: 'visa',
      difficulty: 'medium'
    },
    {
      id: 'visa3',
      question: 'Что такое Elite Visa и какие преимущества она даёт?',
      options: [
        'Elite Visa — это рабочая виза для специалистов',
        'Elite Visa — премиум-программа с долгосрочным правом пребывания (5, 10, 20 лет), упрощённым въездом и дополнительными привилегиями',
        'Elite Visa — виза только для студентов',
        'Elite Visa — виза только для пенсионеров'
      ],
      correctAnswer: 1,
      explanation: 'Elite Visa — премиум-программа с долгосрочным правом пребывания (5, 10, 20 лет), упрощённым въездом, приоритетным прохождением паспортного контроля и дополнительными привилегиями (трансферы, спа, гольф).',
      category: 'visa',
      difficulty: 'medium'
    },
    {
      id: 'visa4',
      question: 'Может ли иностранец получить тайское гражданство?',
      options: [
        'Нет, тайское гражданство недоступно для иностранцев',
        'Да, но процесс сложный и требует длительного проживания, знания языка, интеграции в общество и выполнения определённых условий',
        'Только через брак с тайцем/тайкой',
        'Только при инвестициях более $5 млн'
      ],
      correctAnswer: 1,
      explanation: 'Тайское гражданство доступно, но процесс сложный: требуется длительное проживание (обычно 5+ лет), знание тайского языка, интеграция в общество, отсутствие судимостей и выполнение других условий.',
      category: 'visa',
      difficulty: 'hard'
    },
    {
      id: 'visa5',
      question: 'Что такое Retirement Visa и какие требования к ней?',
      options: [
        'Retirement Visa — виза для студентов',
        'Retirement Visa — для лиц 50+ лет, требует подтверждения дохода или депозита в тайском банке',
        'Retirement Visa — виза для бизнесменов',
        'Retirement Visa доступна с 18 лет'
      ],
      correctAnswer: 1,
      explanation: 'Retirement Visa (Non-Immigrant O-A) — для лиц 50+ лет, требует подтверждения дохода (минимум 65,000 THB/мес) или депозита в тайском банке (минимум 800,000 THB), медицинской страховки и справки о несудимости.',
      category: 'visa',
      difficulty: 'medium'
    },
    {
      id: 'visa6',
      question: 'Может ли иностранец получить тайский паспорт?',
      options: [
        'Нет, тайский паспорт недоступен для иностранцев',
        'Да, после получения гражданства',
        'Только через усыновление',
        'Только для дипломатов'
      ],
      correctAnswer: 1,
      explanation: 'Тайский паспорт выдаётся только гражданам Таиланда. После получения гражданства иностранец может получить тайский паспорт.',
      category: 'visa',
      difficulty: 'easy'
    },
    {
      id: 'visa7',
      question: 'Что такое Long-Term Resident (LTR) Visa?',
      options: [
        'LTR Visa — виза для туристов',
        'LTR Visa — долгосрочная виза (до 10 лет) для высококвалифицированных специалистов, пенсионеров, удалённых работников и инвесторов',
        'LTR Visa — виза только для студентов',
        'LTR Visa — виза только для бизнесменов'
      ],
      correctAnswer: 1,
      explanation: 'LTR Visa — долгосрочная виза (до 10 лет) для высококвалифицированных специалистов, пенсионеров, удалённых работников и инвесторов. Требует определённых критериев (доход, инвестиции, квалификация).',
      category: 'visa',
      difficulty: 'medium'
    },
    {
      id: 'visa8',
      question: 'Можно ли продлевать визу в Таиланде?',
      options: [
        'Нет, визы не продлеваются',
        'Да, большинство долгосрочных виз можно продлевать при соблюдении условий',
        'Только один раз',
        'Только для граждан ЕС'
      ],
      correctAnswer: 1,
      explanation: 'Большинство долгосрочных виз (Retirement, Education, LTR и др.) можно продлевать при соблюдении условий (доход, депозит, статус и т.д.).',
      category: 'visa',
      difficulty: 'easy'
    },

    // Урок 6: Цены
    {
      id: 'price1',
      question: 'Какая средняя стоимость квадратного метра недвижимости на Пхукете?',
      options: [
        '$500–800 за м²',
        '$1,500–3,500 за м² в зависимости от локации и типа объекта',
        '$5,000–10,000 за м²',
        '$15,000+ за м²'
      ],
      correctAnswer: 1,
      explanation: 'Средняя стоимость квадратного метра на Пхукете составляет $1,500–3,500 за м² в зависимости от локации (близость к пляжу, инфраструктура) и типа объекта (кондоминиум, вилла).',
      category: 'prices',
      difficulty: 'medium'
    },
    {
      id: 'price2',
      question: 'Какой фактор наиболее сильно влияет на цену недвижимости в Таиланде?',
      options: [
        'Только размер объекта',
        'Локация (близость к пляжу, инфраструктура, транспортная доступность)',
        'Только год постройки',
        'Только этаж'
      ],
      correctAnswer: 1,
      explanation: 'Локация — ключевой фактор: близость к пляжу, наличие инфраструктуры (школы, больницы, торговые центры), транспортная доступность значительно влияют на цену.',
      category: 'prices',
      difficulty: 'medium'
    },
    {
      id: 'price3',
      question: 'Сколько в среднем стоит кондоминиум на Пхукете?',
      options: [
        '$20,000–30,000',
        '$50,000–150,000 в зависимости от размера, локации и комплекса',
        '$300,000–500,000',
        '$1,000,000+'
      ],
      correctAnswer: 1,
      explanation: 'Средняя стоимость кондоминиума на Пхукете составляет $50,000–150,000 в зависимости от размера (студия, 1–2 спальни), локации (близость к пляжу) и уровня комплекса (инфраструктура, сервисы).',
      category: 'prices',
      difficulty: 'medium'
    },
    {
      id: 'price4',
      question: 'Сколько в среднем стоит вилла на Пхукете?',
      options: [
        '$100,000–200,000',
        '$200,000–800,000 в зависимости от размера, локации и уровня отделки',
        '$1,000,000–2,000,000',
        '$3,000,000+'
      ],
      correctAnswer: 1,
      explanation: 'Средняя стоимость виллы на Пхукете составляет $200,000–800,000 в зависимости от размера (количество спален, площадь участка), локации (близость к пляжу, вид) и уровня отделки.',
      category: 'prices',
      difficulty: 'medium'
    },
    {
      id: 'price5',
      question: 'Какова разница в цене между объектами у пляжа и объектами вдали от моря?',
      options: [
        'Нет разницы',
        'Объекты у пляжа могут стоить на 30–50% дороже',
        'Объекты вдали от моря дороже',
        'Разница незначительна — 5–10%'
      ],
      correctAnswer: 1,
      explanation: 'Объекты у пляжа или с видом на море могут стоить на 30–50% дороже аналогичных объектов вдали от моря из-за высокого спроса и ограниченного предложения.',
      category: 'prices',
      difficulty: 'medium'
    },
    {
      id: 'price6',
      question: 'Влияет ли этаж на цену кондоминиума?',
      options: [
        'Нет, этаж не влияет на цену',
        'Да, верхние этажи с видом обычно стоят дороже',
        'Только первый этаж дороже',
        'Этаж не учитывается при оценке'
      ],
      correctAnswer: 1,
      explanation: 'Верхние этажи с видом на море или панорамным видом обычно стоят дороже нижних этажей из-за лучших видов и меньшего шума.',
      category: 'prices',
      difficulty: 'easy'
    },
    {
      id: 'price7',
      question: 'Какова средняя стоимость аренды кондоминиума на Пхукете?',
      options: [
        '$200–300 в месяц',
        '$500–1,500 в месяц в зависимости от размера, локации и сезона',
        '$2,000–3,000 в месяц',
        '$5,000+ в месяц'
      ],
      correctAnswer: 1,
      explanation: 'Средняя стоимость аренды кондоминиума на Пхукете составляет $500–1,500 в месяц в зависимости от размера (студия, 1–2 спальни), локации (близость к пляжу) и сезона (высокий/низкий сезон).',
      category: 'prices',
      difficulty: 'medium'
    },
    {
      id: 'price8',
      question: 'Какова средняя стоимость аренды виллы на Пхукете?',
      options: [
        '$500–800 в месяц',
        '$1,500–4,000 в месяц в зависимости от размера, локации и сезона',
        '$5,000–8,000 в месяц',
        '$10,000+ в месяц'
      ],
      correctAnswer: 1,
      explanation: 'Средняя стоимость аренды виллы на Пхукете составляет $1,500–4,000 в месяц в зависимости от размера (количество спален, площадь), локации (близость к пляжу, вид) и сезона.',
      category: 'prices',
      difficulty: 'medium'
    },
    {
      id: 'price9',
      question: 'Как изменяются цены на аренду в зависимости от сезона?',
      options: [
        'Цены не меняются в зависимости от сезона',
        'В высокий сезон (ноябрь–февраль) цены могут быть на 30–50% выше, чем в низкий сезон',
        'В низкий сезон цены выше',
        'Сезонность влияет только на виллы, не на кондоминиумы'
      ],
      correctAnswer: 1,
      explanation: 'В высокий сезон (ноябрь–февраль) цены на аренду могут быть на 30–50% выше из-за повышенного спроса. В низкий сезон (июнь–октябрь) цены снижаются.',
      category: 'prices',
      difficulty: 'easy'
    },
    {
      id: 'price10',
      question: 'Какие дополнительные расходы при покупке недвижимости в Таиланде?',
      options: [
        'Только стоимость объекта',
        'Нотариальные сборы, регистрационные пошлины, налоги (обычно 2–5% от стоимости)',
        'Только налог 10%',
        'Дополнительных расходов нет'
      ],
      correctAnswer: 1,
      explanation: 'При покупке недвижимости в Таиланде дополнительные расходы включают: нотариальные сборы, регистрационные пошлины, налоги (обычно 2–5% от стоимости объекта в зависимости от типа сделки и срока владения продавцом).',
      category: 'prices',
      difficulty: 'medium'
    },
    {
      id: 'price11',
      question: 'Какова стоимость содержания недвижимости (коммунальные услуги, обслуживание) в месяц?',
      options: [
        '$10–20 в месяц',
        '$50–150 в месяц в зависимости от размера объекта и потребления',
        '$300–500 в месяц',
        '$1,000+ в месяц'
      ],
      correctAnswer: 1,
      explanation: 'Стоимость содержания недвижимости (электричество, вода, интернет, обслуживание) составляет $50–150 в месяц в зависимости от размера объекта, потребления и уровня сервиса в комплексе.',
      category: 'prices',
      difficulty: 'easy'
    },
    {
      id: 'price12',
      question: 'Влияет ли наличие инфраструктуры (бассейн, фитнес, охрана) на цену объекта?',
      options: [
        'Нет, инфраструктура не влияет на цену',
        'Да, объекты в комплексах с развитой инфраструктурой обычно стоят на 10–20% дороже',
        'Инфраструктура снижает цену',
        'Влияет только для вилл'
      ],
      correctAnswer: 1,
      explanation: 'Объекты в комплексах с развитой инфраструктурой (бассейн, фитнес, охрана, детские площадки) обычно стоят на 10–20% дороже аналогичных объектов без такой инфраструктуры.',
      category: 'prices',
      difficulty: 'medium'
    },

    // Урок 7: Налоги
    {
      id: 'tax1',
      question: 'Какой налог платится при покупке недвижимости в Таиланде?',
      options: [
        'Налог не платится',
        'Stamp duty 0.5% от стоимости или specific business tax 3.3% (если продавец владел менее 5 лет)',
        'Налог 10% от стоимости',
        'Только для иностранцев налог 5%'
      ],
      correctAnswer: 1,
      explanation: 'При покупке недвижимости платится stamp duty 0.5% от стоимости или specific business tax 3.3% (если продавец владел объектом менее 5 лет). Обычно налог делится между покупателем и продавцом.',
      category: 'taxes',
      difficulty: 'medium'
    },
    {
      id: 'tax2',
      question: 'Какой налог платится при продаже недвижимости в Таиланде?',
      options: [
        'Налог не платится',
        'Specific business tax 3.3% (если владели менее 5 лет) или stamp duty 0.5% (если более 5 лет), плюс подоходный налог с прироста капитала',
        'Налог 10% от стоимости',
        'Только для иностранцев налог 5%'
      ],
      correctAnswer: 1,
      explanation: 'При продаже недвижимости платится specific business tax 3.3% (если владели менее 5 лет) или stamp duty 0.5% (если более 5 лет), плюс подоходный налог с прироста капитала по прогрессивной шкале.',
      category: 'taxes',
      difficulty: 'hard'
    },
    {
      id: 'tax3',
      question: 'Облагается ли доход от аренды недвижимости налогом в Таиланде?',
      options: [
        'Нет, доход от аренды не облагается налогом',
        'Да, доход от аренды облагается подоходным налогом по прогрессивной шкале (5–35%)',
        'Только для иностранцев налог 10%',
        'Только если аренда более $10,000 в год'
      ],
      correctAnswer: 1,
      explanation: 'Доход от аренды недвижимости облагается подоходным налогом по прогрессивной шкале (5–35%) в зависимости от суммы дохода. Можно уменьшить налогооблагаемую базу на расходы (ремонт, обслуживание, амортизацию).',
      category: 'taxes',
      difficulty: 'medium'
    },
    {
      id: 'tax4',
      question: 'Какой налог на недвижимость (property tax) платится ежегодно?',
      options: [
        'Налог на недвижимость не платится',
        'Налог на недвижимость (Land and Building Tax) платится ежегодно, ставка зависит от типа и стоимости объекта',
        'Только для иностранцев налог 1%',
        'Только для коммерческой недвижимости'
      ],
      correctAnswer: 1,
      explanation: 'Налог на недвижимость (Land and Building Tax) платится ежегодно. Ставка зависит от типа объекта (жилая, коммерческая) и стоимости. Для жилой недвижимости обычно 0.02–0.1% от оценочной стоимости.',
      category: 'taxes',
      difficulty: 'medium'
    },
    {
      id: 'tax5',
      question: 'Можно ли уменьшить налогооблагаемую базу при расчёте налога с дохода от аренды?',
      options: [
        'Нет, нельзя',
        'Да, можно уменьшить на расходы (ремонт, обслуживание, амортизацию, управление)',
        'Только на 10%',
        'Только для тайцев'
      ],
      correctAnswer: 1,
      explanation: 'Да, можно уменьшить налогооблагаемую базу на расходы, связанные с содержанием и управлением недвижимостью: ремонт, обслуживание, амортизацию, управленческие услуги, коммунальные платежи (если платит владелец).',
      category: 'taxes',
      difficulty: 'medium'
    },
    {
      id: 'tax6',
      question: 'Какой налог платится при наследовании недвижимости в Таиланде?',
      options: [
        'Налог не платится',
        'Налог на наследство (Inheritance Tax) — 5–10% от стоимости в зависимости от степени родства',
        'Налог 20% от стоимости',
        'Только для иностранцев налог 15%'
      ],
      correctAnswer: 1,
      explanation: 'Налог на наследство (Inheritance Tax) составляет 5–10% от стоимости недвижимости в зависимости от степени родства. Для супругов и прямых потомков обычно 5%, для других наследников — 10%.',
      category: 'taxes',
      difficulty: 'hard'
    },
    {
      id: 'tax7',
      question: 'Облагается ли прирост капитала при продаже недвижимости налогом?',
      options: [
        'Нет, прирост капитала не облагается налогом',
        'Да, прирост капитала облагается подоходным налогом по прогрессивной шкале',
        'Только для иностранцев налог 10%',
        'Только если прирост более $50,000'
      ],
      correctAnswer: 1,
      explanation: 'Прирост капитала при продаже недвижимости облагается подоходным налогом по прогрессивной шкале (5–35%). Можно уменьшить налогооблагаемую базу на расходы, связанные с покупкой и улучшением объекта.',
      category: 'taxes',
      difficulty: 'hard'
    },
    {
      id: 'tax8',
      question: 'Какой налог платится при дарении недвижимости в Таиланде?',
      options: [
        'Налог не платится',
        'Налог на дарение (Gift Tax) — 5% от стоимости для близких родственников, 10% для других',
        'Налог 20% от стоимости',
        'Только для иностранцев налог 15%'
      ],
      correctAnswer: 1,
      explanation: 'Налог на дарение (Gift Tax) составляет 5% от стоимости для близких родственников (супруги, родители, дети) и 10% для других получателей.',
      category: 'taxes',
      difficulty: 'hard'
    },
    {
      id: 'tax9',
      question: 'Нужно ли платить налоги в Таиланде, если вы не резидент?',
      options: [
        'Нет, нерезиденты не платят налоги',
        'Нерезиденты платят налоги только с дохода, полученного в Таиланде (аренда, продажа недвижимости)',
        'Только подоходный налог 10%',
        'Только для коммерческой недвижимости'
      ],
      correctAnswer: 1,
      explanation: 'Нерезиденты платят налоги только с дохода, полученного в Таиланде (аренда недвижимости, продажа недвижимости). Доход из других источников не облагается тайскими налогами.',
      category: 'taxes',
      difficulty: 'medium'
    },
    {
      id: 'tax10',
      question: 'Какой срок подачи налоговой декларации в Таиланде?',
      options: [
        'До 31 декабря',
        'До 31 марта следующего года',
        'До 30 июня следующего года',
        'Налоговую декларацию подавать не нужно'
      ],
      correctAnswer: 1,
      explanation: 'Срок подачи налоговой декларации в Таиланде — до 31 марта следующего года за предыдущий налоговый год (календарный год).',
      category: 'taxes',
      difficulty: 'easy'
    },

    // Урок 8: Содержание
    {
      id: 'maint1',
      question: 'Какие основные расходы на содержание недвижимости в Таиланде?',
      options: [
        'Только коммунальные услуги',
        'Коммунальные услуги (электричество, вода, интернет), обслуживание комплекса (если кондоминиум), ремонт и поддержание объекта',
        'Только налоги',
        'Расходов нет'
      ],
      correctAnswer: 1,
      explanation: 'Основные расходы: коммунальные услуги (электричество ~$0.12–0.15/кВт·ч, вода ~$0.5/м³, интернет ~$15–20/мес), обслуживание комплекса (если кондоминиум, обычно $50–200/мес), ремонт и поддержание объекта.',
      category: 'maintenance',
      difficulty: 'medium'
    },
    {
      id: 'maint2',
      question: 'Что такое sinking fund в кондоминиумах?',
      options: [
        'Sinking fund — это налог',
        'Sinking fund — резервный фонд для крупных ремонтов и обновления инфраструктуры комплекса',
        'Sinking fund — это страховка',
        'Sinking fund не используется в Таиланде'
      ],
      correctAnswer: 1,
      explanation: 'Sinking fund — резервный фонд, формируемый из взносов владельцев для финансирования крупных ремонтов, обновления инфраструктуры комплекса (бассейн, лифты, фасады). Обычно единовременный взнос при покупке или регулярные взносы.',
      category: 'maintenance',
      difficulty: 'medium'
    },
    {
      id: 'maint3',
      question: 'Какова средняя стоимость обслуживания комплекса (maintenance fee) для кондоминиума?',
      options: [
        '$10–20 в месяц',
        '$50–200 в месяц в зависимости от размера объекта, уровня комплекса и инфраструктуры',
        '$300–500 в месяц',
        '$1,000+ в месяц'
      ],
      correctAnswer: 1,
      explanation: 'Средняя стоимость обслуживания комплекса (maintenance fee) составляет $50–200 в месяц в зависимости от размера объекта (кв.м), уровня комплекса (премиум/стандарт) и инфраструктуры (бассейн, фитнес, охрана, консьерж).',
      category: 'maintenance',
      difficulty: 'medium'
    },
    {
      id: 'maint4',
      question: 'Кто отвечает за обслуживание и ремонт виллы?',
      options: [
        'Управляющая компания',
        'Владелец самостоятельно или через нанятую управляющую компанию/персонал',
        'Государство',
        'Соседи'
      ],
      correctAnswer: 1,
      explanation: 'Владелец виллы самостоятельно отвечает за обслуживание и ремонт или может нанять управляющую компанию/персонал (садовник, уборщик, охрана) для регулярного обслуживания.',
      category: 'maintenance',
      difficulty: 'easy'
    },
    {
      id: 'maint5',
      question: 'Как часто нужно проводить техническое обслуживание кондиционера в Таиланде?',
      options: [
        'Раз в год',
        'Рекомендуется 2–4 раза в год для оптимальной работы и энергоэффективности',
        'Раз в 5 лет',
        'Техническое обслуживание не требуется'
      ],
      correctAnswer: 1,
      explanation: 'Рекомендуется проводить техническое обслуживание кондиционера 2–4 раза в год (особенно перед и после жаркого сезона) для оптимальной работы, энергоэффективности и предотвращения поломок.',
      category: 'maintenance',
      difficulty: 'easy'
    },
    {
      id: 'maint6',
      question: 'Какие расходы на содержание бассейна в частной вилле?',
      options: [
        'Бассейн не требует расходов',
        'Химикаты, электричество для насосов и фильтров, периодическая чистка — примерно $50–150 в месяц',
        '$500–1,000 в месяц',
        'Только единовременная установка'
      ],
      correctAnswer: 1,
      explanation: 'Расходы на содержание бассейна включают: химикаты (хлор, pH-регуляторы), электричество для насосов и фильтров, периодическую чистку. Примерно $50–150 в месяц в зависимости от размера бассейна.',
      category: 'maintenance',
      difficulty: 'medium'
    },
    {
      id: 'maint7',
      question: 'Что такое common area fee?',
      options: [
        'Common area fee — это налог',
        'Common area fee — плата за обслуживание общих зон комплекса (коридоры, лифты, лобби, парковка)',
        'Common area fee — это страховка',
        'Common area fee не используется в Таиланде'
      ],
      correctAnswer: 1,
      explanation: 'Common area fee — плата за обслуживание общих зон комплекса (коридоры, лифты, лобби, парковка, сады). Обычно включена в maintenance fee или взимается отдельно.',
      category: 'maintenance',
      difficulty: 'easy'
    },
    {
      id: 'maint8',
      question: 'Какова средняя стоимость найма управляющей компании для виллы?',
      options: [
        '$50–100 в месяц',
        '$200–500 в месяц в зависимости от размера виллы и объёма услуг',
        '$1,000–2,000 в месяц',
        'Управляющие компании не работают с виллами'
      ],
      correctAnswer: 1,
      explanation: 'Средняя стоимость найма управляющей компании для виллы составляет $200–500 в месяц в зависимости от размера виллы, объёма услуг (уборка, садоводство, охрана, техническое обслуживание) и частоты визитов.',
      category: 'maintenance',
      difficulty: 'medium'
    },
    {
      id: 'maint9',
      question: 'Какие расходы на страхование недвижимости в Таиланде?',
      options: [
        'Страхование не требуется',
        'Обычно 0.1–0.3% от стоимости объекта в год',
        '5–10% от стоимости объекта в год',
        'Только для коммерческой недвижимости'
      ],
      correctAnswer: 1,
      explanation: 'Расходы на страхование недвижимости обычно составляют 0.1–0.3% от стоимости объекта в год. Страхование покрывает риски пожара, наводнения, кражи и других повреждений.',
      category: 'maintenance',
      difficulty: 'medium'
    },
    {
      id: 'maint10',
      question: 'Как часто нужно проводить покраску фасада здания?',
      options: [
        'Раз в год',
        'Обычно каждые 3–5 лет в зависимости от климатических условий и качества краски',
        'Раз в 10 лет',
        'Покраска не требуется'
      ],
      correctAnswer: 1,
      explanation: 'Обычно покраску фасада проводят каждые 3–5 лет в зависимости от климатических условий (высокая влажность, солнце), качества краски и воздействия окружающей среды. В тропическом климате может требоваться чаще.',
      category: 'maintenance',
      difficulty: 'easy'
    },
    {
      id: 'maint11',
      question: 'Какие расходы на содержание сада/ландшафта в вилле?',
      options: [
        'Сад не требует расходов',
        'Садовник, удобрения, полив, обрезка — примерно $50–150 в месяц в зависимости от размера сада',
        '$500–1,000 в месяц',
        'Только единовременная посадка'
      ],
      correctAnswer: 1,
      explanation: 'Расходы на содержание сада включают: садовника (если нанят), удобрения, полив (электричество/вода), обрезку растений. Примерно $50–150 в месяц в зависимости от размера сада и сложности ландшафта.',
      category: 'maintenance',
      difficulty: 'medium'
    },
    {
      id: 'maint12',
      question: 'Что делать, если в кондоминиуме протекает крыша или есть проблемы с инфраструктурой?',
      options: [
        'Ничего, это нормально',
        'Обратиться в управляющую компанию комплекса — они отвечают за общую инфраструктуру',
        'Самому ремонтировать',
        'Проблемы не решаются'
      ],
      correctAnswer: 1,
      explanation: 'При проблемах с общей инфраструктурой (крыша, лифты, водопровод, электричество в общих зонах) нужно обратиться в управляющую компанию комплекса — они отвечают за обслуживание и ремонт общих зон за счёт maintenance fee и sinking fund.',
      category: 'maintenance',
      difficulty: 'easy'
    }
  ];

  useEffect(() => {
    if (!authLoading && !user) {
      router.push('/');
      return;
    }
    if (user) {
      const name = user.user_metadata?.name || user.email?.split('@')[0] || 'Пользователь';
      setUserName(name);
    }
  }, [user, authLoading, router]);

  useEffect(() => {
    if (!progressLoading && userProgress) {
      setStudiedQuestions(new Set(userProgress.studied_cards));
      setStreak(userProgress.streak);
    }
  }, [userProgress, progressLoading]);

  const loadQuestions = useCallback(() => {
    let filtered = [...allQuestions];

    if (selectedCategory !== 'all') {
      filtered = filtered.filter(q => q.category === selectedCategory);
    }

    // Получаем изученные вопросы из локального стейта
    const studiedSet = new Set(studiedQuestions);

    if (studyMode === 'new') {
      filtered = filtered.filter(q => !studiedSet.has(q.id));
    } else if (studyMode === 'review') {
      filtered = filtered.filter(q => studiedSet.has(q.id));
    }

    // Перемешиваем вопросы и варианты ответов
    const shuffled = filtered.sort(() => Math.random() - 0.5).map(q => {
      // Создаем пары [индекс, вариант_ответа]
      const optionsWithIndices = q.options.map((option, index) => ({ option, index }));
      
      // Перемешиваем пары
      const shuffledPairs = optionsWithIndices.sort(() => Math.random() - 0.5);
      
      // Извлекаем перемешанные варианты
      const shuffledOptions = shuffledPairs.map(p => p.option);
      
      // Находим новую позицию правильного ответа
      const newCorrectAnswer = shuffledPairs.findIndex(p => p.index === q.correctAnswer);
      
      return {
        ...q,
        options: shuffledOptions,
        correctAnswer: newCorrectAnswer
      };
    });
    
    setSessionQuestions(shuffled);
    setCurrentQuestionIndex(0);
    setSelectedAnswer(null);
    setShowExplanation(false);
    setIsCorrectAnswer(false);
    setScore({ correct: 0, total: 0 });
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [selectedCategory, studyMode]);

  useEffect(() => {
    loadQuestions();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [selectedCategory, studyMode]);

  const currentQuestion = sessionQuestions[currentQuestionIndex];

  const handleAnswerSelect = (answerIndex: number) => {
    if (showExplanation || isAnimating) return;
    
    // Сохраняем текущий вопрос ДО любых изменений состояния
    const questionBeingAnswered = currentQuestion;
    const isCorrect = answerIndex === questionBeingAnswered.correctAnswer;
    
    setIsAnimating(true);
    setSelectedAnswer(answerIndex);
    setIsCorrectAnswer(isCorrect); // Сохраняем правильность ответа в state!
    
    setTimeout(() => {
      setShowExplanation(true);
      setIsAnimating(false);
    }, 300);
    
    // Сохраняем в Supabase
    const pointsToAdd = isCorrect ? 2 : 1;
    const categoryName = categories.find(c => c.id === questionBeingAnswered.category)?.name || 'Общие';
    
    if (isCorrect) {
      setScore(prev => ({ ...prev, correct: prev.correct + 1, total: prev.total + 1 }));
      setStreak(prev => prev + 1);
      
      // Сохраняем в Supabase
      updateStreak(true);
      addPoints(pointsToAdd);
      addActivity('trainer', `Тренажёр: ${categoryName}`, pointsToAdd);
    } else {
      setScore(prev => ({ ...prev, total: prev.total + 1 }));
      setStreak(0);
      
      // Сохраняем в Supabase
      updateStreak(false);
      addPoints(pointsToAdd);
      addActivity('trainer', `Тренажёр: ${categoryName}`, pointsToAdd);
    }

    if (questionBeingAnswered) {
      const newStudied = new Set(studiedQuestions);
      newStudied.add(questionBeingAnswered.id);
      setStudiedQuestions(newStudied);
    }
  };

  const handleNext = () => {
    // Сохраняем изученную карточку в Supabase перед переходом
    if (currentQuestion) {
      addStudiedCard(currentQuestion.id);
    }
    
    setIsAnimating(true);
    setTimeout(() => {
      if (currentQuestionIndex < sessionQuestions.length - 1) {
        setCurrentQuestionIndex(prev => prev + 1);
        setSelectedAnswer(null);
        setShowExplanation(false);
        setIsCorrectAnswer(false);
      } else {
        loadQuestions();
      }
      setIsAnimating(false);
    }, 200);
  };

  const categories = [
    { id: 'all', name: 'Все категории', icon: '📚', color: 'from-slate-500 to-slate-600' },
    { id: 'locations', name: 'Районы', icon: '🗺️', color: 'from-blue-500 to-cyan-500' },
    { id: 'taxes', name: 'Налоги', icon: '💰', color: 'from-emerald-500 to-teal-500' },
    { id: 'buying', name: 'Покупка', icon: '📝', color: 'from-purple-500 to-pink-500' },
    { id: 'prices', name: 'Цены', icon: '💵', color: 'from-amber-500 to-orange-500' },
    { id: 'visa', name: 'ВНЖ', icon: '🛂', color: 'from-indigo-500 to-blue-500' },
    { id: 'investment', name: 'Инвестиции', icon: '📈', color: 'from-rose-500 to-pink-500' },
    { id: 'life', name: 'Жизнь в Таиланде', icon: '🌴', color: 'from-teal-500 to-green-500' },
    { id: 'maintenance', name: 'Содержание', icon: '🔧', color: 'from-blue-500 to-cyan-500' },
  ];

  const getDifficultyColor = (difficulty: string) => {
    switch (difficulty) {
      case 'easy': return 'bg-emerald-100 text-emerald-700 border-emerald-300';
      case 'medium': return 'bg-amber-100 text-amber-700 border-amber-300';
      case 'hard': return 'bg-rose-100 text-rose-700 border-rose-300';
      default: return 'bg-gray-100 text-gray-700 border-gray-300';
    }
  };

  const getDifficultyText = (difficulty: string) => {
    switch (difficulty) {
      case 'easy': return 'Легко';
      case 'medium': return 'Средне';
      case 'hard': return 'Сложно';
      default: return '';
    }
  };

  if (authLoading || progressLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-slate-50">
        <Loader2 className="w-8 h-8 animate-spin text-blue-600" />
      </div>
    );
  }

  if (!user) {
    return null;
  }

  if (!currentQuestion && sessionQuestions.length === 0) {
    return (
      <div className="bg-slate-50 min-h-screen flex items-center justify-center p-4">
        <div className="text-center max-w-md bg-white border border-slate-200 rounded-2xl shadow-lg p-8">
          <div className="w-20 h-20 bg-blue-50 rounded-2xl flex items-center justify-center mx-auto mb-6">
            <Brain className="w-10 h-10 text-blue-600" />
          </div>
          <h3 className="text-2xl font-bold text-slate-900 mb-2">Нет вопросов для изучения</h3>
          <p className="text-slate-600 mb-6">Попробуйте изменить фильтры или выбрать другую категорию</p>
          <button 
            onClick={loadQuestions} 
            className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold hover:shadow-lg transition-all"
          >
            Загрузить все вопросы
          </button>
        </div>
      </div>
    );
  }

  const progress = sessionQuestions.length > 0 
    ? ((currentQuestionIndex + 1) / sessionQuestions.length) * 100 
    : 0;

  const currentCategory = categories.find(c => c.id === currentQuestion?.category);

  return (
    <div className="bg-slate-50 min-h-screen flex flex-col font-sans antialiased">
      <AppHeader backHref="/countries/thailand" subtitle="Тренажёр" />

      {/* Main */}
      <main className="flex-grow container mx-auto px-3 sm:px-4 pt-16 sm:pt-20 pb-6 sm:pb-8">
        <div className="max-w-4xl mx-auto">
        {/* Stats */}
        <div className="grid grid-cols-3 gap-2 sm:gap-4 mb-4 sm:mb-6">
          <div className="bg-white border border-slate-200 rounded-lg sm:rounded-xl p-3 sm:p-5 shadow-sm">
            <div className="flex items-center justify-between mb-2 sm:mb-3">
              <span className="text-xs sm:text-sm font-medium text-slate-600">Прогресс</span>
              <TrendingUp className="w-3 h-3 sm:w-4 sm:h-4 text-blue-500" />
            </div>
            <div className="text-lg sm:text-2xl font-bold text-slate-900">{Math.round(progress)}%</div>
            <div className="mt-2 sm:mt-3 w-full bg-slate-200 rounded-full h-1.5 sm:h-2">
              <div
                className="bg-blue-600 h-1.5 sm:h-2 rounded-full transition-all duration-500"
                style={{ width: `${progress}%` }}
              />
            </div>
          </div>
          
          <div className="bg-white border border-slate-200 rounded-lg sm:rounded-xl p-3 sm:p-5 shadow-sm">
            <div className="flex items-center justify-between mb-2 sm:mb-3">
              <span className="text-xs sm:text-sm font-medium text-slate-600">Точность</span>
              <Trophy className="w-3 h-3 sm:w-4 sm:h-4 text-amber-500" />
            </div>
            <div className="text-lg sm:text-2xl font-bold text-slate-900">
              {score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0}%
            </div>
            <div className="mt-1 sm:mt-2 text-[10px] sm:text-xs text-slate-500">
              {score.correct} / {score.total}
            </div>
          </div>

          <div className="bg-white border border-slate-200 rounded-lg sm:rounded-xl p-3 sm:p-5 shadow-sm">
            <div className="flex items-center justify-between mb-2 sm:mb-3">
              <span className="text-xs sm:text-sm font-medium text-slate-600">Вопрос</span>
              <Zap className="w-3 h-3 sm:w-4 sm:h-4 text-emerald-500" />
            </div>
            <div className="text-lg sm:text-2xl font-bold text-slate-900">
              {currentQuestionIndex + 1} / {sessionQuestions.length}
            </div>
            <div className="mt-1 sm:mt-2 text-[10px] sm:text-xs text-slate-500">
              Осталось {sessionQuestions.length - currentQuestionIndex - 1}
            </div>
          </div>
        </div>


        {/* Question Card */}
        {currentQuestion && (
          <div className={`bg-white border border-slate-200 rounded-xl sm:rounded-2xl shadow-lg overflow-hidden transition-all duration-300 ${isAnimating ? 'scale-95 opacity-50' : 'scale-100 opacity-100'}`}>
            {/* Header */}
            <div className="bg-slate-50 border-b border-slate-200 px-4 sm:px-6 py-3 sm:py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2 sm:gap-3">
                  <div className="w-8 h-8 sm:w-10 sm:h-10 bg-blue-50 rounded-lg flex items-center justify-center">
                    <span className="text-lg sm:text-xl">{currentCategory?.icon}</span>
                  </div>
                  <div>
                    <div className="text-slate-900 text-xs sm:text-sm font-semibold">{currentCategory?.name}</div>
                    <span className={`text-[10px] sm:text-xs font-medium ${
                      currentQuestion.difficulty === 'easy' ? 'text-green-600' :
                      currentQuestion.difficulty === 'medium' ? 'text-amber-600' :
                      'text-red-600'
                    }`}>
                      {getDifficultyText(currentQuestion.difficulty)}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            {/* Question */}
            <div className="px-4 sm:px-6 py-5 sm:py-8">
              <h2 className="text-base sm:text-xl font-bold text-slate-900 mb-5 sm:mb-8 leading-relaxed">
                {currentQuestion.question}
              </h2>

              {/* Answer Options */}
              <div className="space-y-2 sm:space-y-3">
                {currentQuestion.options.map((option, index) => {
                  const isSelected = selectedAnswer === index;
                  const isCorrect = index === currentQuestion.correctAnswer;
                  const showResult = showExplanation;

                  let buttonClass = "w-full text-left px-3 sm:px-5 py-3 sm:py-4 rounded-xl border-2 transition-all text-xs sm:text-sm font-medium relative ";
                  
                  if (showResult) {
                    if (isCorrect) {
                      buttonClass += "bg-green-50 border-green-400 text-green-900 ring-2 ring-green-400/20";
                    } else if (isSelected && !isCorrect) {
                      buttonClass += "bg-red-50 border-red-400 text-red-900";
                    } else {
                      buttonClass += "bg-slate-50 border-slate-200 text-slate-500";
                    }
                  } else {
                    buttonClass += "bg-white border-slate-200 text-slate-900 hover:border-blue-400 hover:bg-blue-50 cursor-pointer";
                  }

                  return (
                  <button
                      key={index}
                      onClick={() => handleAnswerSelect(index)}
                      disabled={showExplanation}
                      className={buttonClass}
                    >
                      <div className="flex items-center gap-2 sm:gap-3">
                        <div className={`w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center font-bold text-xs sm:text-sm flex-shrink-0 ${
                          showResult && isCorrect 
                            ? 'bg-green-500 text-white' 
                            : showResult && isSelected && !isCorrect
                            ? 'bg-red-500 text-white'
                            : 'bg-slate-100 text-slate-600'
                        }`}>
                          {String.fromCharCode(65 + index)}
                        </div>
                        <span className="flex-1">{option}</span>
                        {showResult && isCorrect && (
                          <CheckCircle className="w-5 h-5 text-green-600 flex-shrink-0" />
                        )}
                        {showResult && isSelected && !isCorrect && (
                          <XCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
                        )}
                      </div>
                    </button>
                  );
                })}
              </div>

              {/* Explanation */}
              {showExplanation && (
                <div className={`mt-4 sm:mt-6 p-3 sm:p-5 rounded-xl border ${
                  isCorrectAnswer 
                    ? 'bg-green-50 border-green-200' 
                    : 'bg-amber-50 border-amber-200'
                }`}>
                  <div className="flex items-start gap-2 sm:gap-3">
                    <div className={`flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 rounded-lg flex items-center justify-center ${
                      isCorrectAnswer ? 'bg-green-500' : 'bg-amber-500'
                    }`}>
                      {isCorrectAnswer ? (
                        <CheckCircle className="w-5 h-5 sm:w-6 sm:h-6 text-white" />
                      ) : (
                        <XCircle className="w-5 h-5 sm:w-6 sm:h-6 text-white" />
                      )}
                    </div>
                    <div className="flex-1">
                      <p className={`text-sm sm:text-base font-bold mb-1 sm:mb-2 ${
                        isCorrectAnswer ? 'text-green-900' : 'text-amber-900'
                      }`}>
                        {isCorrectAnswer ? '✓ Правильно!' : '✗ Неправильно'}
                      </p>
                      <p className="text-slate-700 leading-relaxed text-xs sm:text-sm">
                        {currentQuestion.explanation}
                      </p>
                    </div>
                  </div>
                </div>
              )}
            </div>

            {/* Next Button */}
            {showExplanation && (
              <div className="px-4 sm:px-6 py-4 sm:py-5 bg-slate-50 border-t border-slate-200">
                {currentQuestionIndex < sessionQuestions.length - 1 ? (
                  <button
                    onClick={handleNext}
                    className="w-full px-4 sm:px-6 py-2.5 sm:py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold text-sm sm:text-base hover:shadow-lg transition-all flex items-center justify-center gap-2"
                  >
                    Следующий вопрос
                    <ChevronRight className="w-5 h-5" />
                  </button>
                ) : (
                  <div className="text-center py-4">
                    <div className="inline-flex items-center justify-center w-16 h-16 bg-green-50 rounded-2xl mb-4">
                      <Trophy className="w-10 h-10 text-green-600" />
                    </div>
                    <h3 className="text-xl font-bold text-slate-900 mb-2">Сессия завершена!</h3>
                    <p className="text-slate-600 mb-1">Вы ответили на {score.total} вопросов</p>
                    <p className="text-lg font-semibold text-blue-600 mb-6">
                      Правильно: {score.correct} из {score.total} ({Math.round((score.correct / score.total) * 100)}%)
                    </p>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                      <button
                        onClick={loadQuestions}
                        className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold hover:shadow-lg transition-all flex items-center justify-center gap-2"
                      >
                        <RotateCcw className="w-5 h-5" />
                        Продолжить обучение
                      </button>
                      <Link
                        href="/countries/thailand"
                        className="px-6 py-3 bg-slate-100 text-slate-700 rounded-xl font-semibold hover:bg-slate-200 transition-all flex items-center justify-center gap-2"
                      >
                        Вернуться в меню
                      </Link>
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>
        )}
        </div>
      </main>

      <AppFooter />
    </div>
  );
}
